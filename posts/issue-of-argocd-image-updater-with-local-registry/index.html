<!DOCTYPE html><html lang="ja-jp" class="scroll-smooth"><head><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><title>argocd-image-updaterがLocal Docker Registryで動かなかった</title><meta name="robots" content="follow, index"/><meta name="description" content="argocd-image-updaterは特定の条件下でLocal Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを持つApplicationを更新できない問題があります。
結論としては、`:`を含むレジストリ名を使ってはいけません。"/><meta property="og:url" content="https://tkat0.dev//posts/issue-of-argocd-image-updater-with-local-registry/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="tkat0.dev"/><meta property="og:description" content="argocd-image-updaterは特定の条件下でLocal Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを持つApplicationを更新できない問題があります。
結論としては、`:`を含むレジストリ名を使ってはいけません。"/><meta property="og:title" content="argocd-image-updaterがLocal Docker Registryで動かなかった"/><meta property="og:image" content="https://tkat0.dev//static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/_tkato_"/><meta name="twitter:title" content="argocd-image-updaterがLocal Docker Registryで動かなかった"/><meta name="twitter:description" content="argocd-image-updaterは特定の条件下でLocal Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを持つApplicationを更新できない問題があります。
結論としては、`:`を含むレジストリ名を使ってはいけません。"/><meta name="twitter:image" content="https://tkat0.dev//static/images/twitter-card.png"/><link rel="canonical" href="https://tkat0.dev//posts/issue-of-argocd-image-updater-with-local-registry/"/><meta property="article:published_time" content="2023-01-06T09:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tkat0.dev//posts/issue-of-argocd-image-updater-with-local-registry"
  },
  "headline": "argocd-image-updaterがLocal Docker Registryで動かなかった",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tkat0.dev//static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-01-06T09:00:00.000Z",
  "dateModified": "2023-01-06T09:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "tkat0"
  },
  "publisher": {
    "@type": "Organization",
    "name": "tkat0",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tkat0.dev//static/images/tkat0.jpg"
    }
  },
  "description": "argocd-image-updaterは特定の条件下でLocal Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを持つApplicationを更新できない問題があります。\n結論としては、`:`を含むレジストリ名を使ってはいけません。"
}</script><meta name="next-head-count" content="19"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/media/2aaf0723e720e8b9.p.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/7079befd3a2cd672.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7079befd3a2cd672.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-70df5622b4020830.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-63d7f848a4309603.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6a9774580a51b196.js" defer=""></script><script src="/_next/static/chunks/896-f5176a3de761310c.js" defer=""></script><script src="/_next/static/chunks/447-6d81102f1475f3cd.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-989a64eb0543fe6c.js" defer=""></script><script src="/_next/static/BbtclRdEExvhlqOtznToX/_buildManifest.js" defer=""></script><script src="/_next/static/BbtclRdEExvhlqOtznToX/_ssgManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="__className_9c9965 flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="tkat0.dev" href="/"><div class="flex items-center justify-between"><div class="mr-3"><img alt="avatar" src="/static/images/tkat0.jpg" width="48" height="48" decoding="async" data-nimg="1" class="rounded-full" loading="lazy" style="color:transparent"/></div><div class="h-6 text-2xl font-semibold">tkat0.dev</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/posts/">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags/">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about/">About</a></div><a class="rounded-lg border-2 border-gray-700 p-1 dark:border-gray-200" href="/en/posts/issue-of-argocd-image-updater-with-local-registry/">EN</a><button aria-label="Toggle Dark Mode" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/posts/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about/">About</a></div></nav></div></div></div></header><main class="mb-auto"><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-01-06T09:00:00.000Z">2023年1月6日</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">argocd-image-updaterがLocal Docker Registryで動かなかった</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><div class="pb-1 text-center"><a href="/en/posts/issue-of-argocd-image-updater-with-local-registry/">Read in English</a></div><details open=""><summary class="ml-6 pt-2 pb-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#summary">Summary</a></li><li class="false"><a href="#background">Background</a></li><li class="false"><a href="#environment">Environment</a></li><li class="false"><a href="#issue">Issue</a></li><li class="false"><a href="#solution">Solution</a></li><li class="false"><a href="#cause">Cause</a></li><li class="false"><a href="#conclusion">Conclusion</a></li></ul></div></details><br/><h1 id="summary"><a href="#summary" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Summary</h1><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/argoproj-labs/argocd-image-updater">argocd-image-updater</a>は特定の条件下で Local Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを Application を更新できない問題があります。 この記事は問題の概要と解決策の簡単なメモです。</p><p>結論としては、<code>:</code>を含むレジストリ名を使ってはいけません。</p><p>もし詳細を知りたい人はコメントで教えて下さい。尚、私は kubernetes を勉強中なので誤りがある可能性があります。</p><h1 id="background"><a href="#background" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Background</h1><ul><li>趣味の kubernetes 環境をローカルマシンで動かしている</li><li>Docker Registry も、ECR や GCR ではなく、ローカルで動かしている</li><li>アプリケーションの CI には tekton、CD には argocd を利用している</li><li>argocd で使う manifest の images の更新を自動化するために、argocd-image-updater を使いたかった</li></ul><h1 id="environment"><a href="#environment" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Environment</h1><ul><li>kubernetes<ul><li>created by microk8s</li><li>work on local machine</li></ul></li><li>Container Registry<ul><li>Use local registry created by microk8s (<code>microk8s enable registry</code>)</li><li>work on NodePort of kubernetes like 192.168.0.100:32000 (default configurations)</li></ul></li><li>argocd<ul><li>v2.5.5+fc3eaec</li></ul></li><li>argocd-image-updater<ul><li>v0.12.1</li></ul></li></ul><h1 id="issue"><a href="#issue" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Issue</h1><p>2 つ以上の Local Registry のイメージを指定した Kustomize を利用する Application で、1 つのイメージしか更新されない問題があります。 ただしイメージが Local Registry（192.168.0.100.32000）である点に注意してください。</p><p>この manifest は、以下の 2 つのイメージを最新に自動更新する設定です。</p><ul><li>192.168.0.100:32000/api-server</li><li>192.168.0.100:32000/app</li></ul><p>CI がイメージを Push すると、argocd-image-updater が自動的に最新のイメージをデプロイすることが期待されます。 argocd-image-updater のログや Event では２つのイメージが期待通り更新されていましたが、結果は 192.168.0.100:32000/app のみ更新されました。</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Application
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> myapp
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> argocd
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/image-list</span><span class="token punctuation">:</span> 192.168.0.100<span class="token punctuation">:</span>32000/api<span class="token punctuation">-</span>server<span class="token punctuation">,</span>192.168.0.100<span class="token punctuation">:</span>32000/app
</span><span class="code-line">
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/force-update</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/update-strategy</span><span class="token punctuation">:</span> latest
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/write-back-method</span><span class="token punctuation">:</span> git
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/git-branch</span><span class="token punctuation">:</span> main
</span><span class="code-line">    <span class="token atrule key">argocd-image-updater.argoproj.io/write-back-target</span><span class="token punctuation">:</span> kustomization
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">project</span><span class="token punctuation">:</span> myapp
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> git@github.com<span class="token punctuation">:</span>tkat0/xxx.git
</span><span class="code-line">    <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> HEAD
</span><span class="code-line">    <span class="token atrule key">path</span><span class="token punctuation">:</span> kubernetes/myapp/development
</span><span class="code-line">  <span class="token atrule key">syncPolicy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">automated</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">prune</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">selfHeal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//kubernetes.default.svc
</span><span class="code-line">    <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span></code></pre></div><h1 id="solution"><a href="#solution" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Solution</h1><p><code>:</code>を含むレジストリ名を使ってはいけません。 そのため、以下の解決案があります。</p><ul><li>Option1: 192.168.0.101 のようなポートを含まない URI で Local Registry を公開する<ul><li>今回はこちらを採用</li></ul></li><li>Option2: GCR, ECR などを利用する</li></ul><p>Option1 では、単純に Local Registry の Service を LoadBalancer にして、192.168.0.101 のようなアドレスで直接アクセスできるようにするだけでも十分だと思いますが、私は Ingress を利用して Local Docker Registry を以下のように設定しました。</p><ul><li>(required) Ingress で<code>/</code>で Service を公開</li><li>(required) nginx.ingress.kubernetes.io/proxy-body-size: &quot;0&quot;</li><li>(optional) host には自分のドメインを設定(cr.cluster.tkat0.dev)<ul><li>利便性のため（尚、このホストは LAN 内のクラスタを解決するように設定していて、public ではない）</li><li><a target="_blank" rel="noopener noreferrer" href="https://sslip.io/">https://sslip.io/</a> のような wild card DNS でも問題ないはず</li></ul></li><li>(optional) microk8s の registry の利用を辞め、helm で registry をデプロイ<ul><li>できる限り manifest を Git 管理したいため</li></ul></li></ul><p>以下が Local Registry のマニフェストです。argocd 経由で helm の <a target="_blank" rel="noopener noreferrer" href="https://github.com/twuni/docker-registry.helm">twuni/docker-registry</a> をインストールし、Ingress を追加しています。（helm chart の設定次第では、すべて Application 内の記述で完結できるかもしれません）</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Ingress
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> cr
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> ingress
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="token punctuation">:</span> <span class="token string">&#x27;false&#x27;</span>
</span><span class="code-line">    <span class="token comment"># NOTE: 413 Request Entity Too Large:</span>
</span><span class="code-line">    <span class="token comment"># https://github.com/kubernetes/ingress-nginx/issues/4825#issuecomment-721911893</span>
</span><span class="code-line">    <span class="token comment"># https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#custom-max-body-size</span>
</span><span class="code-line">    <span class="token comment"># 0 means no upper bound</span>
</span><span class="code-line">    <span class="token atrule key">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="token punctuation">:</span> <span class="token string">&#x27;0&#x27;</span>
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">ingressClassName</span><span class="token punctuation">:</span> nginx
</span><span class="code-line">  <span class="token atrule key">rules</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">host</span><span class="token punctuation">:</span> cr.cluster.tkat0.dev
</span><span class="code-line">      <span class="token atrule key">http</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">paths</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> <span class="token atrule key">path</span><span class="token punctuation">:</span> /
</span><span class="code-line">            <span class="token atrule key">pathType</span><span class="token punctuation">:</span> Prefix
</span><span class="code-line">            <span class="token atrule key">backend</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">service</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>registry
</span><span class="code-line">                <span class="token atrule key">port</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">number</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Application
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>registry
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> argocd
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">project</span><span class="token punctuation">:</span> default
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">chart</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>registry
</span><span class="code-line">    <span class="token comment"># https://github.com/twuni/docker-registry.helm</span>
</span><span class="code-line">    <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//helm.twun.io
</span><span class="code-line">    <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> 2.2.2
</span><span class="code-line">    <span class="token atrule key">helm</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">releaseName</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>registry
</span><span class="code-line">      <span class="token atrule key">parameters</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> service.type
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> ClusterIP
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> garbageCollect.enabled
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> persistence.size
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> 20Gi
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> ingress.enabled
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;false&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">syncPolicy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">automated</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">prune</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">selfHeal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">    <span class="token atrule key">syncOptions</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> CreateNamespace=true
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//kubernetes.default.svc
</span><span class="code-line">    <span class="token atrule key">namespace</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>registry
</span></code></pre></div><h1 id="cause"><a href="#cause" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Cause</h1><p>原因は、argocd の実装に起因します。</p><p>argocd は、Kustomize のイメージを比較するときに最初の<code>:</code>までをイメージの識別子として扱うため、192.168.0.100:32000/api-server と 192.168.0.100:32000/app を同じイメージ（192.168.0.100）として誤って認識します。</p><p>具体的には、argocd-image-updater は、<a target="_blank" rel="noopener noreferrer" href="https://pkg.go.dev/github.com/argoproj-labs/argocd-image-updater/pkg/argocd#SetKustomizeImage">func SetKustomizeImage</a> の中で Application を更新しています。 このメソッドが呼ばれるたびに、1 つずつイメージを Application に追加することが期待されます。</p><p>しかし、<a target="_blank" rel="noopener noreferrer" href="https://pkg.go.dev/github.com/argoproj/argo-cd/v2@v2.2.7/pkg/apis/application/v1alpha1#ApplicationSourceKustomize.MergeImage">func (*ApplicationSourceKustomize) MergeImage</a> と<a target="_blank" rel="noopener noreferrer" href="https://pkg.go.dev/github.com/argoproj/argo-cd/v2/pkg/apis/application/v1alpha1#KustomizeImage.Match">func (KustomizeImage) Match</a>でイメージを追加するのではなく、上書きしていることがわかりました。</p><p>なぜなら、前述の通り<code>:</code>までが同じであればを同じイメージだと判断するためです。</p><p>一般的には、gcr.io/project/image-1:v1.0 と gcr.io/project/image-2:v1.0 のようなイメージは別物と判断されますが、ポートを含む Local Registry では、この問題が起こります。</p><p>レジストリの指定にコロンを含むことは特に production 環境では一般的ではないことは理解できますが、仕様として含んではいけない、という記述は見つけることはできませんでした（もし知っている方がいれば教えて下さい）。 少なくとも、以下では:8080 を含んでも良いように見えます。</p><p><a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/engine/reference/commandline/tag/">https://docs.docker.com/engine/reference/commandline/tag/</a></p><blockquote><p>The hostname must comply with standard DNS rules, but may not contain underscores. If a hostname is present, it may optionally be followed by a port number in the format <code>:8080</code></p></blockquote><h1 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h1><p>この記事では、私が直面した argocd-image-updater が Local Registry で動かない問題について説明しました。</p><p>情報を整理して近日中にコミュニティに報告する予定です。</p><p>update(Jan 7): 報告済み <a target="_blank" rel="noopener noreferrer" href="https://github.com/argoproj-labs/argocd-image-updater/issues/516">https://github.com/argoproj-labs/argocd-image-updater/issues/516</a></p></div></div><div class="pt-6 pb-6 text-center text-gray-700 dark:text-gray-300" id="comment"><div class="giscus"></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: 2022年の振り返り" href="/posts/2022-review/">← <!-- -->2022年の振り返り</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: ChatGPTについて調べた" href="/posts/chatgpt/">ChatGPTについて調べた<!-- --> →</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/tkat0"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/tkat0/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/_tkato_"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>tkat0</div><div> • </div><div>© 2023</div><div> • </div><a href="/">tkat0.dev</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"argocd-image-updaterがLocal Docker Registryで動かなかった","date":"2023-01-06T09:00:00.000Z","tags":["kubernetes","argocd","docker","translated"],"draft":false,"summary":"argocd-image-updaterは特定の条件下でLocal Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを持つApplicationを更新できない問題があります。\n結論としては、`:`を含むレジストリ名を使ってはいけません。","slug":"issue-of-argocd-image-updater-with-local-registry","locale":"ja","body":{"raw":"\n\u003cReadInAnotherLanguage /\u003e\n\u003cTOCInline toc={props.toc} asDisclosure /\u003e\n\u003cbr /\u003e\n\n# Summary\n\n[argocd-image-updater](https://github.com/argoproj-labs/argocd-image-updater)は特定の条件下で Local Docker Registry（e.g. 192.168.0.100:32000）の複数のイメージを Application を更新できない問題があります。\nこの記事は問題の概要と解決策の簡単なメモです。\n\n結論としては、`:`を含むレジストリ名を使ってはいけません。\n\nもし詳細を知りたい人はコメントで教えて下さい。尚、私は kubernetes を勉強中なので誤りがある可能性があります。\n\n# Background\n\n- 趣味の kubernetes 環境をローカルマシンで動かしている\n- Docker Registry も、ECR や GCR ではなく、ローカルで動かしている\n- アプリケーションの CI には tekton、CD には argocd を利用している\n- argocd で使う manifest の images の更新を自動化するために、argocd-image-updater を使いたかった\n\n# Environment\n\n- kubernetes\n  - created by microk8s\n  - work on local machine\n- Container Registry\n  - Use local registry created by microk8s (`microk8s enable registry`)\n  - work on NodePort of kubernetes like 192.168.0.100:32000 (default configurations)\n- argocd\n  - v2.5.5+fc3eaec\n- argocd-image-updater\n  - v0.12.1\n\n# Issue\n\n2 つ以上の Local Registry のイメージを指定した Kustomize を利用する Application で、1 つのイメージしか更新されない問題があります。\nただしイメージが Local Registry（192.168.0.100.32000）である点に注意してください。\n\nこの manifest は、以下の 2 つのイメージを最新に自動更新する設定です。\n\n- 192.168.0.100:32000/api-server\n- 192.168.0.100:32000/app\n\nCI がイメージを Push すると、argocd-image-updater が自動的に最新のイメージをデプロイすることが期待されます。\nargocd-image-updater のログや Event では２つのイメージが期待通り更新されていましたが、結果は 192.168.0.100:32000/app のみ更新されました。\n\n```yaml\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: myapp\n  namespace: argocd\n  annotations:\n    argocd-image-updater.argoproj.io/image-list: 192.168.0.100:32000/api-server,192.168.0.100:32000/app\n\n    argocd-image-updater.argoproj.io/force-update: 'true'\n    argocd-image-updater.argoproj.io/update-strategy: latest\n    argocd-image-updater.argoproj.io/write-back-method: git\n    argocd-image-updater.argoproj.io/git-branch: main\n    argocd-image-updater.argoproj.io/write-back-target: kustomization\nspec:\n  project: myapp\n  source:\n    repoURL: git@github.com:tkat0/xxx.git\n    targetRevision: HEAD\n    path: kubernetes/myapp/development\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: default\n```\n\n# Solution\n\n`:`を含むレジストリ名を使ってはいけません。\nそのため、以下の解決案があります。\n\n- Option1: 192.168.0.101 のようなポートを含まない URI で Local Registry を公開する\n  - 今回はこちらを採用\n- Option2: GCR, ECR などを利用する\n\nOption1 では、単純に Local Registry の Service を LoadBalancer にして、192.168.0.101 のようなアドレスで直接アクセスできるようにするだけでも十分だと思いますが、私は Ingress を利用して Local Docker Registry を以下のように設定しました。\n\n- (required) Ingress で`/`で Service を公開\n- (required) nginx.ingress.kubernetes.io/proxy-body-size: \"0\"\n- (optional) host には自分のドメインを設定(cr.cluster.tkat0.dev)\n  - 利便性のため（尚、このホストは LAN 内のクラスタを解決するように設定していて、public ではない）\n  - https://sslip.io/ のような wild card DNS でも問題ないはず\n- (optional) microk8s の registry の利用を辞め、helm で registry をデプロイ\n  - できる限り manifest を Git 管理したいため\n\n以下が Local Registry のマニフェストです。argocd 経由で helm の [twuni/docker-registry](https://github.com/twuni/docker-registry.helm) をインストールし、Ingress を追加しています。（helm chart の設定次第では、すべて Application 内の記述で完結できるかもしれません）\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: cr\n  namespace: ingress\n  annotations:\n    nginx.ingress.kubernetes.io/ssl-redirect: 'false'\n    # NOTE: 413 Request Entity Too Large:\n    # https://github.com/kubernetes/ingress-nginx/issues/4825#issuecomment-721911893\n    # https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#custom-max-body-size\n    # 0 means no upper bound\n    nginx.ingress.kubernetes.io/proxy-body-size: '0'\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: cr.cluster.tkat0.dev\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: docker-registry\n                port:\n                  number: 5000\n---\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: docker-registry\n  namespace: argocd\nspec:\n  project: default\n  source:\n    chart: docker-registry\n    # https://github.com/twuni/docker-registry.helm\n    repoURL: https://helm.twun.io\n    targetRevision: 2.2.2\n    helm:\n      releaseName: docker-registry\n      parameters:\n        - name: service.type\n          value: ClusterIP\n        - name: garbageCollect.enabled\n          value: 'true'\n        - name: persistence.size\n          value: 20Gi\n        - name: ingress.enabled\n          value: 'false'\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\n    syncOptions:\n      - CreateNamespace=true\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: docker-registry\n```\n\n# Cause\n\n原因は、argocd の実装に起因します。\n\nargocd は、Kustomize のイメージを比較するときに最初の`:`までをイメージの識別子として扱うため、192.168.0.100:32000/api-server と 192.168.0.100:32000/app を同じイメージ（192.168.0.100）として誤って認識します。\n\n具体的には、argocd-image-updater は、[func SetKustomizeImage](https://pkg.go.dev/github.com/argoproj-labs/argocd-image-updater/pkg/argocd#SetKustomizeImage) の中で Application を更新しています。\nこのメソッドが呼ばれるたびに、1 つずつイメージを Application に追加することが期待されます。\n\nしかし、[func (\\*ApplicationSourceKustomize) MergeImage](https://pkg.go.dev/github.com/argoproj/argo-cd/v2@v2.2.7/pkg/apis/application/v1alpha1#ApplicationSourceKustomize.MergeImage)\nと[func (KustomizeImage) Match](https://pkg.go.dev/github.com/argoproj/argo-cd/v2/pkg/apis/application/v1alpha1#KustomizeImage.Match)でイメージを追加するのではなく、上書きしていることがわかりました。\n\nなぜなら、前述の通り`:`までが同じであればを同じイメージだと判断するためです。\n\n一般的には、gcr.io/project/image-1:v1.0 と gcr.io/project/image-2:v1.0 のようなイメージは別物と判断されますが、ポートを含む Local Registry では、この問題が起こります。\n\nレジストリの指定にコロンを含むことは特に production 環境では一般的ではないことは理解できますが、仕様として含んではいけない、という記述は見つけることはできませんでした（もし知っている方がいれば教えて下さい）。\n少なくとも、以下では:8080 を含んでも良いように見えます。\n\nhttps://docs.docker.com/engine/reference/commandline/tag/\n\n\u003e The hostname must comply with standard DNS rules, but may not contain underscores. If a hostname is present, it may optionally be followed by a port number in the format `:8080`\n\n# Conclusion\n\nこの記事では、私が直面した argocd-image-updater が Local Registry で動かない問題について説明しました。\n\n情報を整理して近日中にコミュニティに報告する予定です。\n\nupdate(Jan 7): 報告済み https://github.com/argoproj-labs/argocd-image-updater/issues/516","code":"var Component=(()=\u003e{var h=Object.create;var i=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var g=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=\u003e{for(var s in e)i(a,s,{get:e[s],enumerable:!0})},t=(a,e,s,c)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let l of m(e))!N.call(a,l)\u0026\u0026l!==s\u0026\u0026i(a,l,{get:()=\u003ee[l],enumerable:!(c=u(e,l))||c.enumerable});return a};var b=(a,e,s)=\u003e(s=a!=null?h(k(a)):{},t(e||!a||!a.__esModule?i(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=\u003et(i({},\"__esModule\",{value:!0}),a);var o=g((L,r)=\u003e{r.exports=_jsx_runtime});var j={};y(j,{default:()=\u003eI,frontmatter:()=\u003ev});var n=b(o()),v={title:\"argocd-image-updater\\u304CLocal Docker Registry\\u3067\\u52D5\\u304B\\u306A\\u304B\\u3063\\u305F\",date:new Date(16729956e5),slug:\"issue-of-argocd-image-updater-with-local-registry\",draft:!1,tags:[\"kubernetes\",\"argocd\",\"docker\",\"translated\"],summary:\"argocd-image-updater\\u306F\\u7279\\u5B9A\\u306E\\u6761\\u4EF6\\u4E0B\\u3067Local Docker Registry\\uFF08e.g. 192.168.0.100:32000\\uFF09\\u306E\\u8907\\u6570\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u6301\\u3064Application\\u3092\\u66F4\\u65B0\\u3067\\u304D\\u306A\\u3044\\u554F\\u984C\\u304C\\u3042\\u308A\\u307E\\u3059\\u3002\\n\\u7D50\\u8AD6\\u3068\\u3057\\u3066\\u306F\\u3001`:`\\u3092\\u542B\\u3080\\u30EC\\u30B8\\u30B9\\u30C8\\u30EA\\u540D\\u3092\\u4F7F\\u3063\\u3066\\u306F\\u3044\\u3051\\u307E\\u305B\\u3093\\u3002\"};function d(a){let e=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",ul:\"ul\",li:\"li\",pre:\"pre\",blockquote:\"blockquote\"},a.components),{ReadInAnotherLanguage:s,TOCInline:c}=e;return s||p(\"ReadInAnotherLanguage\",!0),c||p(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s,{}),(0,n.jsx)(c,{toc:a.toc,asDisclosure:!0}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(e.h1,{id:\"summary\",children:[(0,n.jsx)(e.a,{href:\"#summary\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Summary\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/argoproj-labs/argocd-image-updater\",children:\"argocd-image-updater\"}),\"\\u306F\\u7279\\u5B9A\\u306E\\u6761\\u4EF6\\u4E0B\\u3067 Local Docker Registry\\uFF08e.g. 192.168.0.100:32000\\uFF09\\u306E\\u8907\\u6570\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092 Application \\u3092\\u66F4\\u65B0\\u3067\\u304D\\u306A\\u3044\\u554F\\u984C\\u304C\\u3042\\u308A\\u307E\\u3059\\u3002 \\u3053\\u306E\\u8A18\\u4E8B\\u306F\\u554F\\u984C\\u306E\\u6982\\u8981\\u3068\\u89E3\\u6C7A\\u7B56\\u306E\\u7C21\\u5358\\u306A\\u30E1\\u30E2\\u3067\\u3059\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u7D50\\u8AD6\\u3068\\u3057\\u3066\\u306F\\u3001\",(0,n.jsx)(e.code,{children:\":\"}),\"\\u3092\\u542B\\u3080\\u30EC\\u30B8\\u30B9\\u30C8\\u30EA\\u540D\\u3092\\u4F7F\\u3063\\u3066\\u306F\\u3044\\u3051\\u307E\\u305B\\u3093\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u3082\\u3057\\u8A73\\u7D30\\u3092\\u77E5\\u308A\\u305F\\u3044\\u4EBA\\u306F\\u30B3\\u30E1\\u30F3\\u30C8\\u3067\\u6559\\u3048\\u3066\\u4E0B\\u3055\\u3044\\u3002\\u5C1A\\u3001\\u79C1\\u306F kubernetes \\u3092\\u52C9\\u5F37\\u4E2D\\u306A\\u306E\\u3067\\u8AA4\\u308A\\u304C\\u3042\\u308B\\u53EF\\u80FD\\u6027\\u304C\\u3042\\u308A\\u307E\\u3059\\u3002\"}),(0,n.jsxs)(e.h1,{id:\"background\",children:[(0,n.jsx)(e.a,{href:\"#background\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Background\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u8DA3\\u5473\\u306E kubernetes \\u74B0\\u5883\\u3092\\u30ED\\u30FC\\u30AB\\u30EB\\u30DE\\u30B7\\u30F3\\u3067\\u52D5\\u304B\\u3057\\u3066\\u3044\\u308B\"}),(0,n.jsx)(e.li,{children:\"Docker Registry \\u3082\\u3001ECR \\u3084 GCR \\u3067\\u306F\\u306A\\u304F\\u3001\\u30ED\\u30FC\\u30AB\\u30EB\\u3067\\u52D5\\u304B\\u3057\\u3066\\u3044\\u308B\"}),(0,n.jsx)(e.li,{children:\"\\u30A2\\u30D7\\u30EA\\u30B1\\u30FC\\u30B7\\u30E7\\u30F3\\u306E CI \\u306B\\u306F tekton\\u3001CD \\u306B\\u306F argocd \\u3092\\u5229\\u7528\\u3057\\u3066\\u3044\\u308B\"}),(0,n.jsx)(e.li,{children:\"argocd \\u3067\\u4F7F\\u3046 manifest \\u306E images \\u306E\\u66F4\\u65B0\\u3092\\u81EA\\u52D5\\u5316\\u3059\\u308B\\u305F\\u3081\\u306B\\u3001argocd-image-updater \\u3092\\u4F7F\\u3044\\u305F\\u304B\\u3063\\u305F\"})]}),(0,n.jsxs)(e.h1,{id:\"environment\",children:[(0,n.jsx)(e.a,{href:\"#environment\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Environment\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"kubernetes\",(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"created by microk8s\"}),(0,n.jsx)(e.li,{children:\"work on local machine\"})]})]}),(0,n.jsxs)(e.li,{children:[\"Container Registry\",(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Use local registry created by microk8s (\",(0,n.jsx)(e.code,{children:\"microk8s enable registry\"}),\")\"]}),(0,n.jsx)(e.li,{children:\"work on NodePort of kubernetes like 192.168.0.100:32000 (default configurations)\"})]})]}),(0,n.jsxs)(e.li,{children:[\"argocd\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"v2.5.5+fc3eaec\"})})]}),(0,n.jsxs)(e.li,{children:[\"argocd-image-updater\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"v0.12.1\"})})]})]}),(0,n.jsxs)(e.h1,{id:\"issue\",children:[(0,n.jsx)(e.a,{href:\"#issue\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Issue\"]}),(0,n.jsx)(e.p,{children:\"2 \\u3064\\u4EE5\\u4E0A\\u306E Local Registry \\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u6307\\u5B9A\\u3057\\u305F Kustomize \\u3092\\u5229\\u7528\\u3059\\u308B Application \\u3067\\u30011 \\u3064\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3057\\u304B\\u66F4\\u65B0\\u3055\\u308C\\u306A\\u3044\\u554F\\u984C\\u304C\\u3042\\u308A\\u307E\\u3059\\u3002 \\u305F\\u3060\\u3057\\u30A4\\u30E1\\u30FC\\u30B8\\u304C Local Registry\\uFF08192.168.0.100.32000\\uFF09\\u3067\\u3042\\u308B\\u70B9\\u306B\\u6CE8\\u610F\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\"}),(0,n.jsx)(e.p,{children:\"\\u3053\\u306E manifest \\u306F\\u3001\\u4EE5\\u4E0B\\u306E 2 \\u3064\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u6700\\u65B0\\u306B\\u81EA\\u52D5\\u66F4\\u65B0\\u3059\\u308B\\u8A2D\\u5B9A\\u3067\\u3059\\u3002\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"192.168.0.100:32000/api-server\"}),(0,n.jsx)(e.li,{children:\"192.168.0.100:32000/app\"})]}),(0,n.jsx)(e.p,{children:\"CI \\u304C\\u30A4\\u30E1\\u30FC\\u30B8\\u3092 Push \\u3059\\u308B\\u3068\\u3001argocd-image-updater \\u304C\\u81EA\\u52D5\\u7684\\u306B\\u6700\\u65B0\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u30C7\\u30D7\\u30ED\\u30A4\\u3059\\u308B\\u3053\\u3068\\u304C\\u671F\\u5F85\\u3055\\u308C\\u307E\\u3059\\u3002 argocd-image-updater \\u306E\\u30ED\\u30B0\\u3084 Event \\u3067\\u306F\\uFF12\\u3064\\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u304C\\u671F\\u5F85\\u901A\\u308A\\u66F4\\u65B0\\u3055\\u308C\\u3066\\u3044\\u307E\\u3057\\u305F\\u304C\\u3001\\u7D50\\u679C\\u306F 192.168.0.100:32000/app \\u306E\\u307F\\u66F4\\u65B0\\u3055\\u308C\\u307E\\u3057\\u305F\\u3002\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` myapp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/image-list\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" 192.168.0.100\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"32000/api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"192.168.0.100\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`32000/app\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/force-update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/update-strategy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` latest\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/write-back-method\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` git\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/git-branch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` main\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"argocd-image-updater.argoproj.io/write-back-target\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` kustomization\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"project\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` myapp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" git@github.com\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`tkat0/xxx.git\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` HEAD\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` kubernetes/myapp/development\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"syncPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"automated\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"prune\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"selfHeal\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`//kubernetes.default.svc\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` default\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"solution\",children:[(0,n.jsx)(e.a,{href:\"#solution\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Solution\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\":\"}),\"\\u3092\\u542B\\u3080\\u30EC\\u30B8\\u30B9\\u30C8\\u30EA\\u540D\\u3092\\u4F7F\\u3063\\u3066\\u306F\\u3044\\u3051\\u307E\\u305B\\u3093\\u3002 \\u305D\\u306E\\u305F\\u3081\\u3001\\u4EE5\\u4E0B\\u306E\\u89E3\\u6C7A\\u6848\\u304C\\u3042\\u308A\\u307E\\u3059\\u3002\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Option1: 192.168.0.101 \\u306E\\u3088\\u3046\\u306A\\u30DD\\u30FC\\u30C8\\u3092\\u542B\\u307E\\u306A\\u3044 URI \\u3067 Local Registry \\u3092\\u516C\\u958B\\u3059\\u308B\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"\\u4ECA\\u56DE\\u306F\\u3053\\u3061\\u3089\\u3092\\u63A1\\u7528\"})})]}),(0,n.jsx)(e.li,{children:\"Option2: GCR, ECR \\u306A\\u3069\\u3092\\u5229\\u7528\\u3059\\u308B\"})]}),(0,n.jsx)(e.p,{children:\"Option1 \\u3067\\u306F\\u3001\\u5358\\u7D14\\u306B Local Registry \\u306E Service \\u3092 LoadBalancer \\u306B\\u3057\\u3066\\u3001192.168.0.101 \\u306E\\u3088\\u3046\\u306A\\u30A2\\u30C9\\u30EC\\u30B9\\u3067\\u76F4\\u63A5\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u308B\\u3088\\u3046\\u306B\\u3059\\u308B\\u3060\\u3051\\u3067\\u3082\\u5341\\u5206\\u3060\\u3068\\u601D\\u3044\\u307E\\u3059\\u304C\\u3001\\u79C1\\u306F Ingress \\u3092\\u5229\\u7528\\u3057\\u3066 Local Docker Registry \\u3092\\u4EE5\\u4E0B\\u306E\\u3088\\u3046\\u306B\\u8A2D\\u5B9A\\u3057\\u307E\\u3057\\u305F\\u3002\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"(required) Ingress \\u3067\",(0,n.jsx)(e.code,{children:\"/\"}),\"\\u3067 Service \\u3092\\u516C\\u958B\"]}),(0,n.jsx)(e.li,{children:'(required) nginx.ingress.kubernetes.io/proxy-body-size: \"0\"'}),(0,n.jsxs)(e.li,{children:[\"(optional) host \\u306B\\u306F\\u81EA\\u5206\\u306E\\u30C9\\u30E1\\u30A4\\u30F3\\u3092\\u8A2D\\u5B9A(cr.cluster.tkat0.dev)\",(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u5229\\u4FBF\\u6027\\u306E\\u305F\\u3081\\uFF08\\u5C1A\\u3001\\u3053\\u306E\\u30DB\\u30B9\\u30C8\\u306F LAN \\u5185\\u306E\\u30AF\\u30E9\\u30B9\\u30BF\\u3092\\u89E3\\u6C7A\\u3059\\u308B\\u3088\\u3046\\u306B\\u8A2D\\u5B9A\\u3057\\u3066\\u3044\\u3066\\u3001public \\u3067\\u306F\\u306A\\u3044\\uFF09\"}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://sslip.io/\",children:\"https://sslip.io/\"}),\" \\u306E\\u3088\\u3046\\u306A wild card DNS \\u3067\\u3082\\u554F\\u984C\\u306A\\u3044\\u306F\\u305A\"]})]})]}),(0,n.jsxs)(e.li,{children:[\"(optional) microk8s \\u306E registry \\u306E\\u5229\\u7528\\u3092\\u8F9E\\u3081\\u3001helm \\u3067 registry \\u3092\\u30C7\\u30D7\\u30ED\\u30A4\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"\\u3067\\u304D\\u308B\\u9650\\u308A manifest \\u3092 Git \\u7BA1\\u7406\\u3057\\u305F\\u3044\\u305F\\u3081\"})})]})]}),(0,n.jsxs)(e.p,{children:[\"\\u4EE5\\u4E0B\\u304C Local Registry \\u306E\\u30DE\\u30CB\\u30D5\\u30A7\\u30B9\\u30C8\\u3067\\u3059\\u3002argocd \\u7D4C\\u7531\\u3067 helm \\u306E \",(0,n.jsx)(e.a,{href:\"https://github.com/twuni/docker-registry.helm\",children:\"twuni/docker-registry\"}),\" \\u3092\\u30A4\\u30F3\\u30B9\\u30C8\\u30FC\\u30EB\\u3057\\u3001Ingress \\u3092\\u8FFD\\u52A0\\u3057\\u3066\\u3044\\u307E\\u3059\\u3002\\uFF08helm chart \\u306E\\u8A2D\\u5B9A\\u6B21\\u7B2C\\u3067\\u306F\\u3001\\u3059\\u3079\\u3066 Application \\u5185\\u306E\\u8A18\\u8FF0\\u3067\\u5B8C\\u7D50\\u3067\\u304D\\u308B\\u304B\\u3082\\u3057\\u308C\\u307E\\u305B\\u3093\\uFF09\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` networking.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Ingress\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` cr\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ingress\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"nginx.ingress.kubernetes.io/ssl-redirect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'false'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# NOTE: 413 Request Entity Too Large:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# https://github.com/kubernetes/ingress-nginx/issues/4825#issuecomment-721911893\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#custom-max-body-size\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 0 means no upper bound\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"nginx.ingress.kubernetes.io/proxy-body-size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"ingressClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"rules\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"host\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` cr.cluster.tkat0.dev\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"http\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"paths\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` /\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"pathType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Prefix\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"backend\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"service\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`registry\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5000\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`registry\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"project\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"chart\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`registry\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# https://github.com/twuni/docker-registry.helm\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`//helm.twun.io\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` 2.2.2\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"helm\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`registry\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parameters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` service.type\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ClusterIP\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` garbageCollect.enabled\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` persistence.size\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` 20Gi\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ingress.enabled\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'false'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"syncPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"automated\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"prune\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"selfHeal\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"syncOptions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` CreateNamespace=true\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`//kubernetes.default.svc\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`registry\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"cause\",children:[(0,n.jsx)(e.a,{href:\"#cause\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Cause\"]}),(0,n.jsx)(e.p,{children:\"\\u539F\\u56E0\\u306F\\u3001argocd \\u306E\\u5B9F\\u88C5\\u306B\\u8D77\\u56E0\\u3057\\u307E\\u3059\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"argocd \\u306F\\u3001Kustomize \\u306E\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u6BD4\\u8F03\\u3059\\u308B\\u3068\\u304D\\u306B\\u6700\\u521D\\u306E\",(0,n.jsx)(e.code,{children:\":\"}),\"\\u307E\\u3067\\u3092\\u30A4\\u30E1\\u30FC\\u30B8\\u306E\\u8B58\\u5225\\u5B50\\u3068\\u3057\\u3066\\u6271\\u3046\\u305F\\u3081\\u3001192.168.0.100:32000/api-server \\u3068 192.168.0.100:32000/app \\u3092\\u540C\\u3058\\u30A4\\u30E1\\u30FC\\u30B8\\uFF08192.168.0.100\\uFF09\\u3068\\u3057\\u3066\\u8AA4\\u3063\\u3066\\u8A8D\\u8B58\\u3057\\u307E\\u3059\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u5177\\u4F53\\u7684\\u306B\\u306F\\u3001argocd-image-updater \\u306F\\u3001\",(0,n.jsx)(e.a,{href:\"https://pkg.go.dev/github.com/argoproj-labs/argocd-image-updater/pkg/argocd#SetKustomizeImage\",children:\"func SetKustomizeImage\"}),\" \\u306E\\u4E2D\\u3067 Application \\u3092\\u66F4\\u65B0\\u3057\\u3066\\u3044\\u307E\\u3059\\u3002 \\u3053\\u306E\\u30E1\\u30BD\\u30C3\\u30C9\\u304C\\u547C\\u3070\\u308C\\u308B\\u305F\\u3073\\u306B\\u30011 \\u3064\\u305A\\u3064\\u30A4\\u30E1\\u30FC\\u30B8\\u3092 Application \\u306B\\u8FFD\\u52A0\\u3059\\u308B\\u3053\\u3068\\u304C\\u671F\\u5F85\\u3055\\u308C\\u307E\\u3059\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u3057\\u304B\\u3057\\u3001\",(0,n.jsx)(e.a,{href:\"https://pkg.go.dev/github.com/argoproj/argo-cd/v2@v2.2.7/pkg/apis/application/v1alpha1#ApplicationSourceKustomize.MergeImage\",children:\"func (*ApplicationSourceKustomize) MergeImage\"}),\" \\u3068\",(0,n.jsx)(e.a,{href:\"https://pkg.go.dev/github.com/argoproj/argo-cd/v2/pkg/apis/application/v1alpha1#KustomizeImage.Match\",children:\"func (KustomizeImage) Match\"}),\"\\u3067\\u30A4\\u30E1\\u30FC\\u30B8\\u3092\\u8FFD\\u52A0\\u3059\\u308B\\u306E\\u3067\\u306F\\u306A\\u304F\\u3001\\u4E0A\\u66F8\\u304D\\u3057\\u3066\\u3044\\u308B\\u3053\\u3068\\u304C\\u308F\\u304B\\u308A\\u307E\\u3057\\u305F\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u306A\\u305C\\u306A\\u3089\\u3001\\u524D\\u8FF0\\u306E\\u901A\\u308A\",(0,n.jsx)(e.code,{children:\":\"}),\"\\u307E\\u3067\\u304C\\u540C\\u3058\\u3067\\u3042\\u308C\\u3070\\u3092\\u540C\\u3058\\u30A4\\u30E1\\u30FC\\u30B8\\u3060\\u3068\\u5224\\u65AD\\u3059\\u308B\\u305F\\u3081\\u3067\\u3059\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u4E00\\u822C\\u7684\\u306B\\u306F\\u3001gcr.io/project/image-1:v1.0 \\u3068 gcr.io/project/image-2:v1.0 \\u306E\\u3088\\u3046\\u306A\\u30A4\\u30E1\\u30FC\\u30B8\\u306F\\u5225\\u7269\\u3068\\u5224\\u65AD\\u3055\\u308C\\u307E\\u3059\\u304C\\u3001\\u30DD\\u30FC\\u30C8\\u3092\\u542B\\u3080 Local Registry \\u3067\\u306F\\u3001\\u3053\\u306E\\u554F\\u984C\\u304C\\u8D77\\u3053\\u308A\\u307E\\u3059\\u3002\"}),(0,n.jsx)(e.p,{children:\"\\u30EC\\u30B8\\u30B9\\u30C8\\u30EA\\u306E\\u6307\\u5B9A\\u306B\\u30B3\\u30ED\\u30F3\\u3092\\u542B\\u3080\\u3053\\u3068\\u306F\\u7279\\u306B production \\u74B0\\u5883\\u3067\\u306F\\u4E00\\u822C\\u7684\\u3067\\u306F\\u306A\\u3044\\u3053\\u3068\\u306F\\u7406\\u89E3\\u3067\\u304D\\u307E\\u3059\\u304C\\u3001\\u4ED5\\u69D8\\u3068\\u3057\\u3066\\u542B\\u3093\\u3067\\u306F\\u3044\\u3051\\u306A\\u3044\\u3001\\u3068\\u3044\\u3046\\u8A18\\u8FF0\\u306F\\u898B\\u3064\\u3051\\u308B\\u3053\\u3068\\u306F\\u3067\\u304D\\u307E\\u305B\\u3093\\u3067\\u3057\\u305F\\uFF08\\u3082\\u3057\\u77E5\\u3063\\u3066\\u3044\\u308B\\u65B9\\u304C\\u3044\\u308C\\u3070\\u6559\\u3048\\u3066\\u4E0B\\u3055\\u3044\\uFF09\\u3002 \\u5C11\\u306A\\u304F\\u3068\\u3082\\u3001\\u4EE5\\u4E0B\\u3067\\u306F:8080 \\u3092\\u542B\\u3093\\u3067\\u3082\\u826F\\u3044\\u3088\\u3046\\u306B\\u898B\\u3048\\u307E\\u3059\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://docs.docker.com/engine/reference/commandline/tag/\",children:\"https://docs.docker.com/engine/reference/commandline/tag/\"})}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"The hostname must comply with standard DNS rules, but may not contain underscores. If a hostname is present, it may optionally be followed by a port number in the format\\xA0\",(0,n.jsx)(e.code,{children:\":8080\"})]})}),(0,n.jsxs)(e.h1,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{href:\"#conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,n.jsx)(e.p,{children:\"\\u3053\\u306E\\u8A18\\u4E8B\\u3067\\u306F\\u3001\\u79C1\\u304C\\u76F4\\u9762\\u3057\\u305F argocd-image-updater \\u304C Local Registry \\u3067\\u52D5\\u304B\\u306A\\u3044\\u554F\\u984C\\u306B\\u3064\\u3044\\u3066\\u8AAC\\u660E\\u3057\\u307E\\u3057\\u305F\\u3002\"}),(0,n.jsx)(e.p,{children:\"\\u60C5\\u5831\\u3092\\u6574\\u7406\\u3057\\u3066\\u8FD1\\u65E5\\u4E2D\\u306B\\u30B3\\u30DF\\u30E5\\u30CB\\u30C6\\u30A3\\u306B\\u5831\\u544A\\u3059\\u308B\\u4E88\\u5B9A\\u3067\\u3059\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"update(Jan 7): \\u5831\\u544A\\u6E08\\u307F \",(0,n.jsx)(e.a,{href:\"https://github.com/argoproj-labs/argocd-image-updater/issues/516\",children:\"https://github.com/argoproj-labs/argocd-image-updater/issues/516\"})]})]})}function x(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(d,a)})):d(a)}var I=x;function p(a,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f(j);})();\n;return Component;"},"_id":"posts/202301/issue-of-argocd-image-updater-with-local-registry/index.mdx","_raw":{"sourceFilePath":"posts/202301/issue-of-argocd-image-updater-with-local-registry/index.mdx","sourceFileName":"index.mdx","sourceFileDir":"posts/202301/issue-of-argocd-image-updater-with-local-registry","contentType":"mdx","flattenedPath":"posts/202301/issue-of-argocd-image-updater-with-local-registry"},"type":"Blog","readingTime":{"text":"7 min read","minutes":6.56,"time":393600,"words":1312},"path":"posts/issue-of-argocd-image-updater-with-local-registry","filePath":"posts/202301/issue-of-argocd-image-updater-with-local-registry/index.mdx","toc":[{"value":"Summary","url":"#summary","depth":1},{"value":"Background","url":"#background","depth":1},{"value":"Environment","url":"#environment","depth":1},{"value":"Issue","url":"#issue","depth":1},{"value":"Solution","url":"#solution","depth":1},{"value":"Cause","url":"#cause","depth":1},{"value":"Conclusion","url":"#conclusion","depth":1}]},"authorDetails":[{"name":"Tomohiro Kato / @tkat0","avatar":"/static/images/tkat0.jpg","occupation":"Softweare Engineer / Double Bassist","twitter":"https://twitter.com/_tkato_","linkedin":"https://www.linkedin.com/in/tkat0/","github":"https://github.com/tkat0","slug":"default","locale":"en","type":"Authors","readingTime":{"text":"3 min read","minutes":2.33,"time":139800,"words":466},"path":"posts/default","filePath":"authors/default.en.mdx","toc":[{"value":"2021-","url":"#2021-","depth":3},{"value":"2018-2020","url":"#2018-2020","depth":3},{"value":"2014-2017","url":"#2014-2017","depth":3},{"value":"Publications","url":"#publications","depth":3},{"value":"2022","url":"#2022","depth":4},{"value":"2021","url":"#2021","depth":4},{"value":"2020","url":"#2020","depth":4},{"value":"2019","url":"#2019","depth":4},{"value":"2018","url":"#2018","depth":4}],"tags":[]}],"prev":{"title":"2022年の振り返り","date":"2022-12-29T09:00:00.000Z","tags":["yearly-review","translated"],"draft":false,"summary":"2022年の振り返り。","slug":"2022-review","locale":"ja","type":"Blog","readingTime":{"text":"5 min read","minutes":4.91,"time":294600,"words":982},"path":"posts/2022-review","filePath":"posts/202212/2022-review.mdx","toc":[{"value":"プロダクト開発に関わっていました","url":"#プロダクト開発に関わっていました","depth":1},{"value":"使える技術が増えました","url":"#使える技術が増えました","depth":1},{"value":"キャリアを振り返って","url":"#キャリアを振り返って","depth":1},{"value":"まとめ","url":"#まとめ","depth":1}]},"next":{"title":"ChatGPTについて調べた","date":"2023-03-12T13:00:00.000Z","tags":["chatgpt"],"lastmod":"2023-03-19T23:00:00.000Z","draft":false,"summary":"ChatGPTについて調べたことを随時更新するページです。","slug":"chatgpt","locale":"ja","type":"Blog","readingTime":{"text":"11 min read","minutes":10.53,"time":631800,"words":2106},"path":"posts/chatgpt","filePath":"posts/202303/chatgpt/index.mdx","toc":[{"value":"ChatGPT とは","url":"#chatgpt-とは","depth":1},{"value":"Limitations/Issues","url":"#limitationsissues","depth":1},{"value":"利用形態","url":"#利用形態","depth":1},{"value":"ChatGPT API","url":"#chatgpt-api","depth":2},{"value":"応用プロダクト","url":"#応用プロダクト","depth":1},{"value":"その他応用","url":"#その他応用","depth":1},{"value":"どのようにプロダクトに応用するのか","url":"#どのようにプロダクトに応用するのか","depth":1},{"value":"UI デザイン","url":"#ui-デザイン","depth":2},{"value":"プロンプトデザイン","url":"#プロンプトデザイン","depth":2},{"value":"Alternative","url":"#alternative","depth":1},{"value":"どう ChatGPT と接するか","url":"#どう-chatgpt-と接するか","depth":1},{"value":"その他","url":"#その他","depth":1},{"value":"References","url":"#references","depth":1}]}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["issue-of-argocd-image-updater-with-local-registry"]},"buildId":"BbtclRdEExvhlqOtznToX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>