<!DOCTYPE html><html lang="ja-jp" class="scroll-smooth"><head><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><title>いまさらONNXを調べた(v1.4.1)</title><meta name="robots" content="follow, index"/><meta name="description" content="ONNXは1年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。"/><meta property="og:url" content="https://tkat0.dev//posts/learn-onnx/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="tkat0.dev"/><meta property="og:description" content="ONNXは1年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。"/><meta property="og:title" content="いまさらONNXを調べた(v1.4.1)"/><meta property="og:image" content="https://tkat0.dev//static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/_tkato_"/><meta name="twitter:title" content="いまさらONNXを調べた(v1.4.1)"/><meta name="twitter:description" content="ONNXは1年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。"/><meta name="twitter:image" content="https://tkat0.dev//static/images/twitter-card.png"/><link rel="canonical" href="https://tkat0.dev//posts/learn-onnx/"/><meta property="article:published_time" content="2019-02-02T04:00:01.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tkat0.dev//posts/learn-onnx"
  },
  "headline": "いまさらONNXを調べた(v1.4.1)",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tkat0.dev//static/images/twitter-card.png"
    }
  ],
  "datePublished": "2019-02-02T04:00:01.000Z",
  "dateModified": "2019-02-02T04:00:01.000Z",
  "author": {
    "@type": "Person",
    "name": "tkat0"
  },
  "publisher": {
    "@type": "Organization",
    "name": "tkat0",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tkat0.dev//static/images/tkat0.jpg"
    }
  },
  "description": "ONNXは1年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。"
}</script><meta name="next-head-count" content="19"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/media/2aaf0723e720e8b9.p.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/7079befd3a2cd672.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7079befd3a2cd672.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-70df5622b4020830.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-63d7f848a4309603.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6a9774580a51b196.js" defer=""></script><script src="/_next/static/chunks/896-f5176a3de761310c.js" defer=""></script><script src="/_next/static/chunks/447-6d81102f1475f3cd.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-989a64eb0543fe6c.js" defer=""></script><script src="/_next/static/BbtclRdEExvhlqOtznToX/_buildManifest.js" defer=""></script><script src="/_next/static/BbtclRdEExvhlqOtznToX/_ssgManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="__className_9c9965 flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="tkat0.dev" href="/"><div class="flex items-center justify-between"><div class="mr-3"><img alt="avatar" src="/static/images/tkat0.jpg" width="48" height="48" decoding="async" data-nimg="1" class="rounded-full" loading="lazy" style="color:transparent"/></div><div class="h-6 text-2xl font-semibold">tkat0.dev</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/posts/">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags/">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about/">About</a></div><a class="rounded-lg border-2 border-gray-700 p-1 dark:border-gray-200" href="/en/posts/learn-onnx/">EN</a><button aria-label="Toggle Dark Mode" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/posts/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about/">About</a></div></nav></div></div></div></header><main class="mb-auto"><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2019-02-02T04:00:01.000Z">2019年2月2日</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">いまさらONNXを調べた(v1.4.1)</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p><a target="_blank" rel="noopener noreferrer" href="https://onnx.ai/">ONNX</a>は 1 年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。</p><p><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/_tkato_/status/1076019658300346368">https://twitter.com/_tkato_/status/1076019658300346368</a></p><p>とか言ってた。</p><ul><li>以下、ONNXv1.4.1 を対象<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/tree/v1.4.1">https://github.com/onnx/onnx/tree/v1.4.1</a></li></ul></li><li>ONNX のドキュメントは GitHub にまとまっている<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/tree/v1.4.1#learn-about-the-onnx-spec">Learn about ONNX spec</a></li><li>この記事は上記のドキュメントから必要なところをまとめたもの</li></ul></li><li>ONNX 自体は Protobuf で定義した仕様で、ランタイム非依存。</li><li>ONNX と ONNX-ML があるけど、主に DeepLearning 向けに使いたいので ONNX について調べた</li></ul><h2 id="onnxproto"><a href="#onnxproto" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>onnx.proto</h2><p>IR の仕様は以下で説明されている。 <a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md">https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md</a></p><p>これらは proto ファイルに実体が定義されているので、あわせてみるとわかりやすい。</p><p>IR の定義の.proto<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3">https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3</a></p><p>例えば<a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L190-L234"><code>ModelProto</code></a>が<a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#models">ここの</a>モデル定義 同様に proto とドキュメントが対応付けできる。</p><p>また、ONNX でつかえる行列データは Tensor 型があるが、以下の定義。<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L281-L314">https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L281-L314</a></p><p>ポピュラーなのは uint8~float64 かな。 任意精度はなさそうだけど Issue に上がっていた気がする。</p><p>続いて IR の上に構築される Operator や OperatorSet の定義<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx-operators.proto3">https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx-operators.proto3</a></p><p>Operator は Conv とか FC とか。OperatorSet はそれらをまとめてバージョン付したもの。 デフォルトでは ai.onnx の opset が使える。これで足りない場合はユーザーが同様に定義できる。 詳細は以下。<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#operator-sets">https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#operator-sets</a></p><p>protobuf は、コンパイルすることで C++や Python から呼び出せるクラスになる。<br/><code>int64 version = 2;</code> のような右辺は field number で、後方互換性を保ってフィールドを追加したり名前を変えたりするための識別子。</p><h2 id="versioning"><a href="#versioning" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Versioning</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/docs/Versioning.md">https://github.com/onnx/onnx/blob/v1.4.1/docs/Versioning.md</a></p><p>特に道具として ONNX を使おうとするとこのバージョンの理解は必要。 フレームワーク A から B へ ONNX 経由で変換したいときに、バージョン違いで変換できないこともあるので。</p><p>IR, model, opset でそれぞれバージョンを定義。使う側として意識するのは opset かな。</p><ul><li>IR specification<ul><li>Float などの型定義など、Operator などを構築する IR そのもの</li><li>最新は v4 で BFLOAT16 型の追加など</li></ul></li><li>version of model<ul><li>学習済みモデルを ONNX として配布する場合のバージョンの付け方（任意）</li></ul></li><li>version of operator set<ul><li>conv, fc など operator の集合を定義して、そのバージョン管理をする</li><li>例えば opset v9 から XXX は導入されたとかそういう</li><li>モデルは、自身が依存する opset とそのバージョンを明示する(例: このモデルは ai.onnx v9 の opset を使いますよ)</li><li>opset 自体もユーザーが定義できる</li><li>version だけでなく status 属性（EXPERIMENTAL or STABLE）もあり、STABLE になったら変更してはいけない</li></ul></li></ul><p>あとは ONNX 自体も semantic versioning でバージョン付されている。</p><p>opset のバージョンが違う場合に変換するための Version Converter がある。 だけど、opset v9 には対応していないのかな。issue にも上がっていた気がした。 これらのツールは基本 C++で書いてあるけど Python で呼び出せるように wrap されている。</p><p>ONNX Model Opset Version Converter<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/v1.4.1/docs/OpsetVersionConverter.md">https://github.com/onnx/onnx/blob/v1.4.1/docs/OpsetVersionConverter.md</a></p><h2 id="onnx-optimizer"><a href="#onnx-optimizer" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ONNX Optimizer</h2><p>ONNX Optimizer<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/master/docs/Optimizer.md">https://github.com/onnx/onnx/blob/master/docs/Optimizer.md</a></p><p>コンパイラのパスと同じようなもの。 ONNX のバックエンドに実装されるであろう最適化の中でもバックエンド比依存のものは IR でやっていきましょうというよくあるもの。</p><p>汎用的な pass は以下に組み込まれている <a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/tree/master/onnx/optimizer/passes">https://github.com/onnx/onnx/tree/master/onnx/optimizer/passes</a></p><p><code>fuse_bn_into_conv</code> などある。グラフレベルの最適化、ある程度 ONNX でやっちゃっても良さそう。</p><p>pass は Python ではかけないみたい。Python でかけると色々やりたいことあるんだけどな。</p><h2 id="typedenotation"><a href="#typedenotation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>TypeDenotation</h2><p>onnx/TypeDenotation.md at master · onnx/onnx<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/master/docs/TypeDenotation.md">https://github.com/onnx/onnx/blob/master/docs/TypeDenotation.md</a></p><p>onnx/MetadataProps.md at master · onnx/onnx<br/><a target="_blank" rel="noopener noreferrer" href="https://github.com/onnx/onnx/blob/master/docs/MetadataProps.md">https://github.com/onnx/onnx/blob/master/docs/MetadataProps.md</a></p><p>モデルのメタデータをどうやって保持するか。これ面白い。</p><p>denotation 属性に RGB とか、NHCW のどれかとかを格納するみたい。値が取りうる範囲 0-255 とかも。</p><p>モデルの前処理後処理の情報もメタデータとして ONNX に書くのは良いですね。やろうと思えばソフトウェアで処理できる。</p><hr/><p>これで ONNX の上を歩けるようになったぞ〜。万が一バックエンド実装する機会が来たら、また詳細を調べようか。</p></div></div><div class="pt-6 pb-6 text-center text-gray-700 dark:text-gray-300" id="comment"><div class="giscus"></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: Distillerのthinningの仕様" href="/posts/distiller-thinning/">← <!-- -->Distillerのthinningの仕様</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: Chainer-compiler調査（1）" href="/posts/learn-chainer-compiler-1/">Chainer-compiler調査（1）<!-- --> →</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/tkat0"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/tkat0/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/_tkato_"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>tkat0</div><div> • </div><div>© 2023</div><div> • </div><a href="/">tkat0.dev</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"いまさらONNXを調べた(v1.4.1)","date":"2019-02-02T04:00:01.000Z","tags":["onnx","deeplearning"],"summary":"ONNXは1年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。","slug":"learn-onnx","locale":"ja","body":{"raw":"\n[ONNX](https://onnx.ai/)は 1 年以上前から使ってるもののちゃんと仕様しらないな〜、だったので調べた。\n\nhttps://twitter.com/_tkato_/status/1076019658300346368\n\nとか言ってた。\n\n- 以下、ONNXv1.4.1 を対象\n  - https://github.com/onnx/onnx/tree/v1.4.1\n- ONNX のドキュメントは GitHub にまとまっている\n  - [Learn about ONNX spec](https://github.com/onnx/onnx/tree/v1.4.1#learn-about-the-onnx-spec)\n  - この記事は上記のドキュメントから必要なところをまとめたもの\n- ONNX 自体は Protobuf で定義した仕様で、ランタイム非依存。\n- ONNX と ONNX-ML があるけど、主に DeepLearning 向けに使いたいので ONNX について調べた\n\n## onnx.proto\n\nIR の仕様は以下で説明されている。\nhttps://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md\n\nこれらは proto ファイルに実体が定義されているので、あわせてみるとわかりやすい。\n\nIR の定義の.proto \\\nhttps://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3\n\n例えば[`ModelProto`](https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L190-L234)が[ここの](https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#models)モデル定義\n同様に proto とドキュメントが対応付けできる。\n\nまた、ONNX でつかえる行列データは Tensor 型があるが、以下の定義。 \\\nhttps://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L281-L314\n\nポピュラーなのは uint8~float64 かな。\n任意精度はなさそうだけど Issue に上がっていた気がする。\n\n続いて IR の上に構築される Operator や OperatorSet の定義 \\\nhttps://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx-operators.proto3\n\nOperator は Conv とか FC とか。OperatorSet はそれらをまとめてバージョン付したもの。\nデフォルトでは ai.onnx の opset が使える。これで足りない場合はユーザーが同様に定義できる。\n詳細は以下。 \\\nhttps://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#operator-sets\n\nprotobuf は、コンパイルすることで C++や Python から呼び出せるクラスになる。 \\\n`int64 version = 2;` のような右辺は field number で、後方互換性を保ってフィールドを追加したり名前を変えたりするための識別子。\n\n## Versioning\n\nhttps://github.com/onnx/onnx/blob/v1.4.1/docs/Versioning.md\n\n特に道具として ONNX を使おうとするとこのバージョンの理解は必要。\nフレームワーク A から B へ ONNX 経由で変換したいときに、バージョン違いで変換できないこともあるので。\n\nIR, model, opset でそれぞれバージョンを定義。使う側として意識するのは opset かな。\n\n- IR specification\n  - Float などの型定義など、Operator などを構築する IR そのもの\n  - 最新は v4 で BFLOAT16 型の追加など\n- version of model\n  - 学習済みモデルを ONNX として配布する場合のバージョンの付け方（任意）\n- version of operator set\n  - conv, fc など operator の集合を定義して、そのバージョン管理をする\n  - 例えば opset v9 から XXX は導入されたとかそういう\n  - モデルは、自身が依存する opset とそのバージョンを明示する(例: このモデルは ai.onnx v9 の opset を使いますよ)\n  - opset 自体もユーザーが定義できる\n  - version だけでなく status 属性（EXPERIMENTAL or STABLE）もあり、STABLE になったら変更してはいけない\n\nあとは ONNX 自体も semantic versioning でバージョン付されている。\n\nopset のバージョンが違う場合に変換するための Version Converter がある。\nだけど、opset v9 には対応していないのかな。issue にも上がっていた気がした。\nこれらのツールは基本 C++で書いてあるけど Python で呼び出せるように wrap されている。\n\nONNX Model Opset Version Converter \\\nhttps://github.com/onnx/onnx/blob/v1.4.1/docs/OpsetVersionConverter.md\n\n## ONNX Optimizer\n\nONNX Optimizer \\\nhttps://github.com/onnx/onnx/blob/master/docs/Optimizer.md\n\nコンパイラのパスと同じようなもの。\nONNX のバックエンドに実装されるであろう最適化の中でもバックエンド比依存のものは IR でやっていきましょうというよくあるもの。\n\n汎用的な pass は以下に組み込まれている\nhttps://github.com/onnx/onnx/tree/master/onnx/optimizer/passes\n\n`fuse_bn_into_conv` などある。グラフレベルの最適化、ある程度 ONNX でやっちゃっても良さそう。\n\npass は Python ではかけないみたい。Python でかけると色々やりたいことあるんだけどな。\n\n## TypeDenotation\n\nonnx/TypeDenotation.md at master · onnx/onnx \\\nhttps://github.com/onnx/onnx/blob/master/docs/TypeDenotation.md\n\nonnx/MetadataProps.md at master · onnx/onnx \\\nhttps://github.com/onnx/onnx/blob/master/docs/MetadataProps.md\n\nモデルのメタデータをどうやって保持するか。これ面白い。\n\ndenotation 属性に RGB とか、NHCW のどれかとかを格納するみたい。値が取りうる範囲 0-255 とかも。\n\nモデルの前処理後処理の情報もメタデータとして ONNX に書くのは良いですね。やろうと思えばソフトウェアで処理できる。\n\n---\n\nこれで ONNX の上を歩けるようになったぞ〜。万が一バックエンド実装する機会が来たら、また詳細を調べようか。\n","code":"var Component=(()=\u003e{var p=Object.create;var i=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var u=(e,n)=\u003e()=\u003e(n||e((n={exports:{}}).exports,n),n.exports),N=(e,n)=\u003e{for(var t in n)i(e,t,{get:n[t],enumerable:!0})},c=(e,n,t,h)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let r of x(n))!m.call(e,r)\u0026\u0026r!==t\u0026\u0026i(e,r,{get:()=\u003en[r],enumerable:!(h=a(n,r))||h.enumerable});return e};var g=(e,n,t)=\u003e(t=e!=null?p(b(e)):{},c(n||!e||!e.__esModule?i(t,\"default\",{value:e,enumerable:!0}):t,e)),v=e=\u003ec(i({},\"__esModule\",{value:!0}),e);var d=u((R,l)=\u003e{l.exports=_jsx_runtime});var I={};N(I,{default:()=\u003eX,frontmatter:()=\u003eO});var o=g(d()),O={title:\"\\u3044\\u307E\\u3055\\u3089ONNX\\u3092\\u8ABF\\u3079\\u305F(v1.4.1)\",date:new Date(1549080001e3),slug:\"learn-onnx\",tags:[\"onnx\",\"deeplearning\"],summary:\"ONNX\\u306F1\\u5E74\\u4EE5\\u4E0A\\u524D\\u304B\\u3089\\u4F7F\\u3063\\u3066\\u308B\\u3082\\u306E\\u306E\\u3061\\u3083\\u3093\\u3068\\u4ED5\\u69D8\\u3057\\u3089\\u306A\\u3044\\u306A\\u301C\\u3001\\u3060\\u3063\\u305F\\u306E\\u3067\\u8ABF\\u3079\\u305F\\u3002\"};function s(e){let n=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",h2:\"h2\",span:\"span\",br:\"br\",code:\"code\",hr:\"hr\"},e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:\"https://onnx.ai/\",children:\"ONNX\"}),\"\\u306F 1 \\u5E74\\u4EE5\\u4E0A\\u524D\\u304B\\u3089\\u4F7F\\u3063\\u3066\\u308B\\u3082\\u306E\\u306E\\u3061\\u3083\\u3093\\u3068\\u4ED5\\u69D8\\u3057\\u3089\\u306A\\u3044\\u306A\\u301C\\u3001\\u3060\\u3063\\u305F\\u306E\\u3067\\u8ABF\\u3079\\u305F\\u3002\"]}),(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:\"https://twitter.com/_tkato_/status/1076019658300346368\",children:\"https://twitter.com/_tkato_/status/1076019658300346368\"})}),(0,o.jsx)(n.p,{children:\"\\u3068\\u304B\\u8A00\\u3063\\u3066\\u305F\\u3002\"}),(0,o.jsxs)(n.ul,{children:[(0,o.jsxs)(n.li,{children:[\"\\u4EE5\\u4E0B\\u3001ONNXv1.4.1 \\u3092\\u5BFE\\u8C61\",(0,o.jsx)(n.ul,{children:(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/tree/v1.4.1\",children:\"https://github.com/onnx/onnx/tree/v1.4.1\"})})})]}),(0,o.jsxs)(n.li,{children:[\"ONNX \\u306E\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\u306F GitHub \\u306B\\u307E\\u3068\\u307E\\u3063\\u3066\\u3044\\u308B\",(0,o.jsxs)(n.ul,{children:[(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/tree/v1.4.1#learn-about-the-onnx-spec\",children:\"Learn about ONNX spec\"})}),(0,o.jsx)(n.li,{children:\"\\u3053\\u306E\\u8A18\\u4E8B\\u306F\\u4E0A\\u8A18\\u306E\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\u304B\\u3089\\u5FC5\\u8981\\u306A\\u3068\\u3053\\u308D\\u3092\\u307E\\u3068\\u3081\\u305F\\u3082\\u306E\"})]})]}),(0,o.jsx)(n.li,{children:\"ONNX \\u81EA\\u4F53\\u306F Protobuf \\u3067\\u5B9A\\u7FA9\\u3057\\u305F\\u4ED5\\u69D8\\u3067\\u3001\\u30E9\\u30F3\\u30BF\\u30A4\\u30E0\\u975E\\u4F9D\\u5B58\\u3002\"}),(0,o.jsx)(n.li,{children:\"ONNX \\u3068 ONNX-ML \\u304C\\u3042\\u308B\\u3051\\u3069\\u3001\\u4E3B\\u306B DeepLearning \\u5411\\u3051\\u306B\\u4F7F\\u3044\\u305F\\u3044\\u306E\\u3067 ONNX \\u306B\\u3064\\u3044\\u3066\\u8ABF\\u3079\\u305F\"})]}),(0,o.jsxs)(n.h2,{id:\"onnxproto\",children:[(0,o.jsx)(n.a,{href:\"#onnxproto\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,o.jsx)(n.span,{className:\"icon icon-link\"})}),\"onnx.proto\"]}),(0,o.jsxs)(n.p,{children:[\"IR \\u306E\\u4ED5\\u69D8\\u306F\\u4EE5\\u4E0B\\u3067\\u8AAC\\u660E\\u3055\\u308C\\u3066\\u3044\\u308B\\u3002 \",(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md\"})]}),(0,o.jsx)(n.p,{children:\"\\u3053\\u308C\\u3089\\u306F proto \\u30D5\\u30A1\\u30A4\\u30EB\\u306B\\u5B9F\\u4F53\\u304C\\u5B9A\\u7FA9\\u3055\\u308C\\u3066\\u3044\\u308B\\u306E\\u3067\\u3001\\u3042\\u308F\\u305B\\u3066\\u307F\\u308B\\u3068\\u308F\\u304B\\u308A\\u3084\\u3059\\u3044\\u3002\"}),(0,o.jsxs)(n.p,{children:[\"IR \\u306E\\u5B9A\\u7FA9\\u306E.proto\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3\"})]}),(0,o.jsxs)(n.p,{children:[\"\\u4F8B\\u3048\\u3070\",(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L190-L234\",children:(0,o.jsx)(n.code,{children:\"ModelProto\"})}),\"\\u304C\",(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#models\",children:\"\\u3053\\u3053\\u306E\"}),\"\\u30E2\\u30C7\\u30EB\\u5B9A\\u7FA9 \\u540C\\u69D8\\u306B proto \\u3068\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\u304C\\u5BFE\\u5FDC\\u4ED8\\u3051\\u3067\\u304D\\u308B\\u3002\"]}),(0,o.jsxs)(n.p,{children:[\"\\u307E\\u305F\\u3001ONNX \\u3067\\u3064\\u304B\\u3048\\u308B\\u884C\\u5217\\u30C7\\u30FC\\u30BF\\u306F Tensor \\u578B\\u304C\\u3042\\u308B\\u304C\\u3001\\u4EE5\\u4E0B\\u306E\\u5B9A\\u7FA9\\u3002\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L281-L314\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx.proto3#L281-L314\"})]}),(0,o.jsx)(n.p,{children:\"\\u30DD\\u30D4\\u30E5\\u30E9\\u30FC\\u306A\\u306E\\u306F uint8~float64 \\u304B\\u306A\\u3002 \\u4EFB\\u610F\\u7CBE\\u5EA6\\u306F\\u306A\\u3055\\u305D\\u3046\\u3060\\u3051\\u3069 Issue \\u306B\\u4E0A\\u304C\\u3063\\u3066\\u3044\\u305F\\u6C17\\u304C\\u3059\\u308B\\u3002\"}),(0,o.jsxs)(n.p,{children:[\"\\u7D9A\\u3044\\u3066 IR \\u306E\\u4E0A\\u306B\\u69CB\\u7BC9\\u3055\\u308C\\u308B Operator \\u3084 OperatorSet \\u306E\\u5B9A\\u7FA9\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx-operators.proto3\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/onnx/onnx-operators.proto3\"})]}),(0,o.jsxs)(n.p,{children:[\"Operator \\u306F Conv \\u3068\\u304B FC \\u3068\\u304B\\u3002OperatorSet \\u306F\\u305D\\u308C\\u3089\\u3092\\u307E\\u3068\\u3081\\u3066\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u4ED8\\u3057\\u305F\\u3082\\u306E\\u3002 \\u30C7\\u30D5\\u30A9\\u30EB\\u30C8\\u3067\\u306F ai.onnx \\u306E opset \\u304C\\u4F7F\\u3048\\u308B\\u3002\\u3053\\u308C\\u3067\\u8DB3\\u308A\\u306A\\u3044\\u5834\\u5408\\u306F\\u30E6\\u30FC\\u30B6\\u30FC\\u304C\\u540C\\u69D8\\u306B\\u5B9A\\u7FA9\\u3067\\u304D\\u308B\\u3002 \\u8A73\\u7D30\\u306F\\u4EE5\\u4E0B\\u3002\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#operator-sets\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/IR.md#operator-sets\"})]}),(0,o.jsxs)(n.p,{children:[\"protobuf \\u306F\\u3001\\u30B3\\u30F3\\u30D1\\u30A4\\u30EB\\u3059\\u308B\\u3053\\u3068\\u3067 C++\\u3084 Python \\u304B\\u3089\\u547C\\u3073\\u51FA\\u305B\\u308B\\u30AF\\u30E9\\u30B9\\u306B\\u306A\\u308B\\u3002\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.code,{children:\"int64 version = 2;\"}),\" \\u306E\\u3088\\u3046\\u306A\\u53F3\\u8FBA\\u306F field number \\u3067\\u3001\\u5F8C\\u65B9\\u4E92\\u63DB\\u6027\\u3092\\u4FDD\\u3063\\u3066\\u30D5\\u30A3\\u30FC\\u30EB\\u30C9\\u3092\\u8FFD\\u52A0\\u3057\\u305F\\u308A\\u540D\\u524D\\u3092\\u5909\\u3048\\u305F\\u308A\\u3059\\u308B\\u305F\\u3081\\u306E\\u8B58\\u5225\\u5B50\\u3002\"]}),(0,o.jsxs)(n.h2,{id:\"versioning\",children:[(0,o.jsx)(n.a,{href:\"#versioning\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,o.jsx)(n.span,{className:\"icon icon-link\"})}),\"Versioning\"]}),(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/Versioning.md\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/Versioning.md\"})}),(0,o.jsx)(n.p,{children:\"\\u7279\\u306B\\u9053\\u5177\\u3068\\u3057\\u3066 ONNX \\u3092\\u4F7F\\u304A\\u3046\\u3068\\u3059\\u308B\\u3068\\u3053\\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u306E\\u7406\\u89E3\\u306F\\u5FC5\\u8981\\u3002 \\u30D5\\u30EC\\u30FC\\u30E0\\u30EF\\u30FC\\u30AF A \\u304B\\u3089 B \\u3078 ONNX \\u7D4C\\u7531\\u3067\\u5909\\u63DB\\u3057\\u305F\\u3044\\u3068\\u304D\\u306B\\u3001\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u9055\\u3044\\u3067\\u5909\\u63DB\\u3067\\u304D\\u306A\\u3044\\u3053\\u3068\\u3082\\u3042\\u308B\\u306E\\u3067\\u3002\"}),(0,o.jsx)(n.p,{children:\"IR, model, opset \\u3067\\u305D\\u308C\\u305E\\u308C\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u3092\\u5B9A\\u7FA9\\u3002\\u4F7F\\u3046\\u5074\\u3068\\u3057\\u3066\\u610F\\u8B58\\u3059\\u308B\\u306E\\u306F opset \\u304B\\u306A\\u3002\"}),(0,o.jsxs)(n.ul,{children:[(0,o.jsxs)(n.li,{children:[\"IR specification\",(0,o.jsxs)(n.ul,{children:[(0,o.jsx)(n.li,{children:\"Float \\u306A\\u3069\\u306E\\u578B\\u5B9A\\u7FA9\\u306A\\u3069\\u3001Operator \\u306A\\u3069\\u3092\\u69CB\\u7BC9\\u3059\\u308B IR \\u305D\\u306E\\u3082\\u306E\"}),(0,o.jsx)(n.li,{children:\"\\u6700\\u65B0\\u306F v4 \\u3067 BFLOAT16 \\u578B\\u306E\\u8FFD\\u52A0\\u306A\\u3069\"})]})]}),(0,o.jsxs)(n.li,{children:[\"version of model\",(0,o.jsx)(n.ul,{children:(0,o.jsx)(n.li,{children:\"\\u5B66\\u7FD2\\u6E08\\u307F\\u30E2\\u30C7\\u30EB\\u3092 ONNX \\u3068\\u3057\\u3066\\u914D\\u5E03\\u3059\\u308B\\u5834\\u5408\\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u306E\\u4ED8\\u3051\\u65B9\\uFF08\\u4EFB\\u610F\\uFF09\"})})]}),(0,o.jsxs)(n.li,{children:[\"version of operator set\",(0,o.jsxs)(n.ul,{children:[(0,o.jsx)(n.li,{children:\"conv, fc \\u306A\\u3069 operator \\u306E\\u96C6\\u5408\\u3092\\u5B9A\\u7FA9\\u3057\\u3066\\u3001\\u305D\\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u7BA1\\u7406\\u3092\\u3059\\u308B\"}),(0,o.jsx)(n.li,{children:\"\\u4F8B\\u3048\\u3070 opset v9 \\u304B\\u3089 XXX \\u306F\\u5C0E\\u5165\\u3055\\u308C\\u305F\\u3068\\u304B\\u305D\\u3046\\u3044\\u3046\"}),(0,o.jsx)(n.li,{children:\"\\u30E2\\u30C7\\u30EB\\u306F\\u3001\\u81EA\\u8EAB\\u304C\\u4F9D\\u5B58\\u3059\\u308B opset \\u3068\\u305D\\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u3092\\u660E\\u793A\\u3059\\u308B(\\u4F8B: \\u3053\\u306E\\u30E2\\u30C7\\u30EB\\u306F ai.onnx v9 \\u306E opset \\u3092\\u4F7F\\u3044\\u307E\\u3059\\u3088)\"}),(0,o.jsx)(n.li,{children:\"opset \\u81EA\\u4F53\\u3082\\u30E6\\u30FC\\u30B6\\u30FC\\u304C\\u5B9A\\u7FA9\\u3067\\u304D\\u308B\"}),(0,o.jsx)(n.li,{children:\"version \\u3060\\u3051\\u3067\\u306A\\u304F status \\u5C5E\\u6027\\uFF08EXPERIMENTAL or STABLE\\uFF09\\u3082\\u3042\\u308A\\u3001STABLE \\u306B\\u306A\\u3063\\u305F\\u3089\\u5909\\u66F4\\u3057\\u3066\\u306F\\u3044\\u3051\\u306A\\u3044\"})]})]})]}),(0,o.jsx)(n.p,{children:\"\\u3042\\u3068\\u306F ONNX \\u81EA\\u4F53\\u3082 semantic versioning \\u3067\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u4ED8\\u3055\\u308C\\u3066\\u3044\\u308B\\u3002\"}),(0,o.jsx)(n.p,{children:\"opset \\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u304C\\u9055\\u3046\\u5834\\u5408\\u306B\\u5909\\u63DB\\u3059\\u308B\\u305F\\u3081\\u306E Version Converter \\u304C\\u3042\\u308B\\u3002 \\u3060\\u3051\\u3069\\u3001opset v9 \\u306B\\u306F\\u5BFE\\u5FDC\\u3057\\u3066\\u3044\\u306A\\u3044\\u306E\\u304B\\u306A\\u3002issue \\u306B\\u3082\\u4E0A\\u304C\\u3063\\u3066\\u3044\\u305F\\u6C17\\u304C\\u3057\\u305F\\u3002 \\u3053\\u308C\\u3089\\u306E\\u30C4\\u30FC\\u30EB\\u306F\\u57FA\\u672C C++\\u3067\\u66F8\\u3044\\u3066\\u3042\\u308B\\u3051\\u3069 Python \\u3067\\u547C\\u3073\\u51FA\\u305B\\u308B\\u3088\\u3046\\u306B wrap \\u3055\\u308C\\u3066\\u3044\\u308B\\u3002\"}),(0,o.jsxs)(n.p,{children:[\"ONNX Model Opset Version Converter\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/OpsetVersionConverter.md\",children:\"https://github.com/onnx/onnx/blob/v1.4.1/docs/OpsetVersionConverter.md\"})]}),(0,o.jsxs)(n.h2,{id:\"onnx-optimizer\",children:[(0,o.jsx)(n.a,{href:\"#onnx-optimizer\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,o.jsx)(n.span,{className:\"icon icon-link\"})}),\"ONNX Optimizer\"]}),(0,o.jsxs)(n.p,{children:[\"ONNX Optimizer\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/master/docs/Optimizer.md\",children:\"https://github.com/onnx/onnx/blob/master/docs/Optimizer.md\"})]}),(0,o.jsx)(n.p,{children:\"\\u30B3\\u30F3\\u30D1\\u30A4\\u30E9\\u306E\\u30D1\\u30B9\\u3068\\u540C\\u3058\\u3088\\u3046\\u306A\\u3082\\u306E\\u3002 ONNX \\u306E\\u30D0\\u30C3\\u30AF\\u30A8\\u30F3\\u30C9\\u306B\\u5B9F\\u88C5\\u3055\\u308C\\u308B\\u3067\\u3042\\u308D\\u3046\\u6700\\u9069\\u5316\\u306E\\u4E2D\\u3067\\u3082\\u30D0\\u30C3\\u30AF\\u30A8\\u30F3\\u30C9\\u6BD4\\u4F9D\\u5B58\\u306E\\u3082\\u306E\\u306F IR \\u3067\\u3084\\u3063\\u3066\\u3044\\u304D\\u307E\\u3057\\u3087\\u3046\\u3068\\u3044\\u3046\\u3088\\u304F\\u3042\\u308B\\u3082\\u306E\\u3002\"}),(0,o.jsxs)(n.p,{children:[\"\\u6C4E\\u7528\\u7684\\u306A pass \\u306F\\u4EE5\\u4E0B\\u306B\\u7D44\\u307F\\u8FBC\\u307E\\u308C\\u3066\\u3044\\u308B \",(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/tree/master/onnx/optimizer/passes\",children:\"https://github.com/onnx/onnx/tree/master/onnx/optimizer/passes\"})]}),(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:\"fuse_bn_into_conv\"}),\" \\u306A\\u3069\\u3042\\u308B\\u3002\\u30B0\\u30E9\\u30D5\\u30EC\\u30D9\\u30EB\\u306E\\u6700\\u9069\\u5316\\u3001\\u3042\\u308B\\u7A0B\\u5EA6 ONNX \\u3067\\u3084\\u3063\\u3061\\u3083\\u3063\\u3066\\u3082\\u826F\\u3055\\u305D\\u3046\\u3002\"]}),(0,o.jsx)(n.p,{children:\"pass \\u306F Python \\u3067\\u306F\\u304B\\u3051\\u306A\\u3044\\u307F\\u305F\\u3044\\u3002Python \\u3067\\u304B\\u3051\\u308B\\u3068\\u8272\\u3005\\u3084\\u308A\\u305F\\u3044\\u3053\\u3068\\u3042\\u308B\\u3093\\u3060\\u3051\\u3069\\u306A\\u3002\"}),(0,o.jsxs)(n.h2,{id:\"typedenotation\",children:[(0,o.jsx)(n.a,{href:\"#typedenotation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,o.jsx)(n.span,{className:\"icon icon-link\"})}),\"TypeDenotation\"]}),(0,o.jsxs)(n.p,{children:[\"onnx/TypeDenotation.md at master \\xB7 onnx/onnx\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/master/docs/TypeDenotation.md\",children:\"https://github.com/onnx/onnx/blob/master/docs/TypeDenotation.md\"})]}),(0,o.jsxs)(n.p,{children:[\"onnx/MetadataProps.md at master \\xB7 onnx/onnx\",(0,o.jsx)(n.br,{}),(0,o.jsx)(n.a,{href:\"https://github.com/onnx/onnx/blob/master/docs/MetadataProps.md\",children:\"https://github.com/onnx/onnx/blob/master/docs/MetadataProps.md\"})]}),(0,o.jsx)(n.p,{children:\"\\u30E2\\u30C7\\u30EB\\u306E\\u30E1\\u30BF\\u30C7\\u30FC\\u30BF\\u3092\\u3069\\u3046\\u3084\\u3063\\u3066\\u4FDD\\u6301\\u3059\\u308B\\u304B\\u3002\\u3053\\u308C\\u9762\\u767D\\u3044\\u3002\"}),(0,o.jsx)(n.p,{children:\"denotation \\u5C5E\\u6027\\u306B RGB \\u3068\\u304B\\u3001NHCW \\u306E\\u3069\\u308C\\u304B\\u3068\\u304B\\u3092\\u683C\\u7D0D\\u3059\\u308B\\u307F\\u305F\\u3044\\u3002\\u5024\\u304C\\u53D6\\u308A\\u3046\\u308B\\u7BC4\\u56F2 0-255 \\u3068\\u304B\\u3082\\u3002\"}),(0,o.jsx)(n.p,{children:\"\\u30E2\\u30C7\\u30EB\\u306E\\u524D\\u51E6\\u7406\\u5F8C\\u51E6\\u7406\\u306E\\u60C5\\u5831\\u3082\\u30E1\\u30BF\\u30C7\\u30FC\\u30BF\\u3068\\u3057\\u3066 ONNX \\u306B\\u66F8\\u304F\\u306E\\u306F\\u826F\\u3044\\u3067\\u3059\\u306D\\u3002\\u3084\\u308D\\u3046\\u3068\\u601D\\u3048\\u3070\\u30BD\\u30D5\\u30C8\\u30A6\\u30A7\\u30A2\\u3067\\u51E6\\u7406\\u3067\\u304D\\u308B\\u3002\"}),(0,o.jsx)(n.hr,{}),(0,o.jsx)(n.p,{children:\"\\u3053\\u308C\\u3067 ONNX \\u306E\\u4E0A\\u3092\\u6B69\\u3051\\u308B\\u3088\\u3046\\u306B\\u306A\\u3063\\u305F\\u305E\\u301C\\u3002\\u4E07\\u304C\\u4E00\\u30D0\\u30C3\\u30AF\\u30A8\\u30F3\\u30C9\\u5B9F\\u88C5\\u3059\\u308B\\u6A5F\\u4F1A\\u304C\\u6765\\u305F\\u3089\\u3001\\u307E\\u305F\\u8A73\\u7D30\\u3092\\u8ABF\\u3079\\u3088\\u3046\\u304B\\u3002\"})]})}function f(e={}){let{wrapper:n}=e.components||{};return n?(0,o.jsx)(n,Object.assign({},e,{children:(0,o.jsx)(s,e)})):s(e)}var X=f;return v(I);})();\n;return Component;"},"_id":"posts/201902/learn-onnx.mdx","_raw":{"sourceFilePath":"posts/201902/learn-onnx.mdx","sourceFileName":"learn-onnx.mdx","sourceFileDir":"posts/201902","contentType":"mdx","flattenedPath":"posts/201902/learn-onnx"},"type":"Blog","readingTime":{"text":"6 min read","minutes":5.48,"time":328800,"words":1096},"path":"posts/learn-onnx","filePath":"posts/201902/learn-onnx.mdx","toc":[{"value":"onnx.proto","url":"#onnxproto","depth":2},{"value":"Versioning","url":"#versioning","depth":2},{"value":"ONNX Optimizer","url":"#onnx-optimizer","depth":2},{"value":"TypeDenotation","url":"#typedenotation","depth":2}]},"authorDetails":[{"name":"Tomohiro Kato / @tkat0","avatar":"/static/images/tkat0.jpg","occupation":"Softweare Engineer / Double Bassist","twitter":"https://twitter.com/_tkato_","linkedin":"https://www.linkedin.com/in/tkat0/","github":"https://github.com/tkat0","slug":"default","locale":"en","type":"Authors","readingTime":{"text":"3 min read","minutes":2.33,"time":139800,"words":466},"path":"posts/default","filePath":"authors/default.en.mdx","toc":[{"value":"2021-","url":"#2021-","depth":3},{"value":"2018-2020","url":"#2018-2020","depth":3},{"value":"2014-2017","url":"#2014-2017","depth":3},{"value":"Publications","url":"#publications","depth":3},{"value":"2022","url":"#2022","depth":4},{"value":"2021","url":"#2021","depth":4},{"value":"2020","url":"#2020","depth":4},{"value":"2019","url":"#2019","depth":4},{"value":"2018","url":"#2018","depth":4}],"tags":[]}],"prev":{"title":"Distillerのthinningの仕様","date":"2019-02-02T03:00:01.000Z","tags":["distiller","deeplearning","pruning"],"summary":"DistillerはPytorch向けのpruningやquantizationを行うライブラリだが、Channel Pruning後にWeightをshrinkしてサイズを小さくする\"thinning\"ができる。\n今回はそのソースを読んで気がついたことのまとめ。","slug":"distiller-thinning","locale":"ja","type":"Blog","readingTime":{"text":"3 min read","minutes":3,"time":180000,"words":600},"path":"posts/distiller-thinning","filePath":"posts/201902/distiller-thinning.mdx","toc":[]},"next":{"title":"Chainer-compiler調査（1）","date":"2019-02-04T00:30:00.000Z","tags":["chainer-compiler","deeplearning","chainer"],"summary":"今日からChainer-compilerについて調べてみよう。","slug":"learn-chainer-compiler-1","locale":"ja","type":"Blog","readingTime":{"text":"6 min read","minutes":5.59,"time":335400,"words":1118},"path":"posts/learn-chainer-compiler-1","filePath":"posts/201902/learn-chainer-compiler-1.mdx","toc":[{"value":"Examples","url":"#examples","depth":2},{"value":"Overview of components","url":"#overview-of-components","depth":2},{"value":"chainer-compiler/python","url":"#chainer-compilerpython","depth":2},{"value":"次にやりたいこと","url":"#次にやりたいこと","depth":2}]}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["learn-onnx"]},"buildId":"BbtclRdEExvhlqOtznToX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>