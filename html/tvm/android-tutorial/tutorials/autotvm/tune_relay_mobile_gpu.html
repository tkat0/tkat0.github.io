

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Auto-tuning a convolutional network for Mobile GPU &mdash; tvm 0.6.dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tvm_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Auto-tuning a convolutional network for ARM CPU" href="tune_relay_arm.html" />
    <link rel="prev" title="Auto-tuning a convolutional network for NVIDIA GPU" href="tune_relay_cuda.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.6.dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../relay_quick_start.html">Quick Start Tutorial for Compiling Deep Learning Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross_compilation_and_rpc.html">Cross Compilation and RPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tensor_expr_get_started.html">Get Started with Tensor Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#compile-deep-learning-models">Compile Deep Learning Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tensor-expression-and-schedules">Tensor Expression and Schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#optimize-tensor-operators">Optimize Tensor Operators</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#auto-tuning">Auto tuning</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tune_simple_template.html">Writing tunable template and Using auto-tuner</a></li>
<li class="toctree-l3"><a class="reference internal" href="tune_relay_x86.html">Auto-tuning a convolutional network for x86 CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="tune_conv2d_cuda.html">Tuning High Performance Convolution on NVIDIA GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="tune_relay_cuda.html">Auto-tuning a convolutional network for NVIDIA GPU</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Auto-tuning a convolutional network for Mobile GPU</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-dependencies">Install dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-network">Define network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-rpc-tracker">Start RPC Tracker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-devices-to-rpc-tracker">Register devices to RPC Tracker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tuning-options">Set Tuning Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#begin-tuning">Begin Tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-output">Sample Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tune_relay_arm.html">Auto-tuning a convolutional network for ARM CPU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#developer-tutorials">Developer Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#topi-tvm-operator-inventory">TOPI: TVM Operator Inventory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vta/index.html">VTA: Deep Learning Accelerator Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/index.html">Deploy and Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute to TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_links.html">Links to API References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/index.html">Design and Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nnvm_top.html">NNVM Core Tensor Operators</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tvm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials</a> &raquo;</li>
        
      <li>Auto-tuning a convolutional network for Mobile GPU</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/autotvm/tune_relay_mobile_gpu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-tutorials-autotvm-tune-relay-mobile-gpu-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="auto-tuning-a-convolutional-network-for-mobile-gpu">
<span id="sphx-glr-tutorials-autotvm-tune-relay-mobile-gpu-py"></span><h1>Auto-tuning a convolutional network for Mobile GPU<a class="headerlink" href="#auto-tuning-a-convolutional-network-for-mobile-gpu" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Author</strong>: <a class="reference external" href="https://https://github.com/merrymercy">Lianmin Zheng</a>, <a class="reference external" href="https://github.com/eqy">Eddie Yan</a></p>
<p>Auto-tuning for a specific device is critical for getting the best
performance. This is a tutorial about how to tune a whole convolutional
network.</p>
<p>The operator implementation for Mobile GPU in TVM is written in template form.
The template has many tunable knobs (tile factor, vectorization, unrolling, etc).
We will tune all convolution, depthwise convolution and dense operators
in the neural network. After tuning, we produce a log file which stores
the best knob values for all required operators. When the tvm compiler compiles
these operators, it will query this log file to get the best knob values.</p>
<p>We also released pre-tuned parameters for some arm devices. You can go to
<a class="reference external" href="https://github.com/dmlc/tvm/wiki/Benchmark#mobile-gpu">Mobile GPU Benchmark</a>
to see the results.</p>
<div class="section" id="install-dependencies">
<h2>Install dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this headline">Â¶</a></h2>
<p>To use the autotvm package in tvm, we need to install some extra dependencies.
(change â3â to â2â if you use python2):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --user psutil xgboost tornado
</pre></div>
</div>
<p>To make tvm run faster during tuning, it is recommended to use cython
as FFI of tvm. In the root directory of tvm, execute
(change â3â to â2â if you use python2):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --user cython
sudo make cython3
</pre></div>
</div>
<p>Now return to python code. Import packages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">tvm</span>
<span class="kn">from</span> <span class="nn">tvm</span> <span class="kn">import</span> <span class="n">autotvm</span>
<span class="kn">from</span> <span class="nn">tvm</span> <span class="kn">import</span> <span class="n">relay</span>
<span class="kn">import</span> <span class="nn">tvm.relay.testing</span>
<span class="kn">from</span> <span class="nn">tvm.autotvm.tuner</span> <span class="kn">import</span> <span class="n">XGBTuner</span><span class="p">,</span> <span class="n">GATuner</span><span class="p">,</span> <span class="n">RandomTuner</span><span class="p">,</span> <span class="n">GridSearchTuner</span>
<span class="kn">from</span> <span class="nn">tvm.contrib.util</span> <span class="kn">import</span> <span class="n">tempdir</span>
<span class="kn">import</span> <span class="nn">tvm.contrib.graph_runtime</span> <span class="kn">as</span> <span class="nn">runtime</span>
</pre></div>
</div>
</div>
<div class="section" id="define-network">
<h2>Define network<a class="headerlink" href="#define-network" title="Permalink to this headline">Â¶</a></h2>
<p>First we need to define the network in relay frontend API.
We can load some pre-defined network from <code class="code docutils literal notranslate"><span class="pre">relay.testing</span></code>.
We can also load models from MXNet, ONNX and TensorFlow.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the symbol definition and random weight of a network&quot;&quot;&quot;</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
    <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;resnet&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">n_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">resnet</span><span class="o">.</span><span class="n">get_workload</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">n_layer</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;vgg&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">n_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">vgg</span><span class="o">.</span><span class="n">get_workload</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">n_layer</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mobilenet&#39;</span><span class="p">:</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">mobilenet</span><span class="o">.</span><span class="n">get_workload</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;squeezenet_v1.1&#39;</span><span class="p">:</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">squeezenet</span><span class="o">.</span><span class="n">get_workload</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.1&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;inception_v3&#39;</span><span class="p">:</span>
        <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">299</span><span class="p">,</span> <span class="mi">299</span><span class="p">)</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">inception_v3</span><span class="o">.</span><span class="n">get_workload</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mxnet&#39;</span><span class="p">:</span>
        <span class="c1"># an example for mxnet model</span>
        <span class="kn">from</span> <span class="nn">mxnet.gluon.model_zoo.vision</span> <span class="kn">import</span> <span class="n">get_model</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s1">&#39;resnet18_v1&#39;</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">net</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">frontend</span><span class="o">.</span><span class="n">from_mxnet</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">input_shape</span><span class="p">},</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">relay</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">body</span><span class="p">),</span> <span class="bp">None</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">type_params</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported network: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">net</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">,</span> <span class="n">output_shape</span>
</pre></div>
</div>
</div>
<div class="section" id="start-rpc-tracker">
<h2>Start RPC Tracker<a class="headerlink" href="#start-rpc-tracker" title="Permalink to this headline">Â¶</a></h2>
<p>TVM uses RPC session to communicate with ARM boards.
During tuning, the tuner will send the generated code to the board and
measure the speed of code on the board.</p>
<p>To scale up the tuning, TVM uses RPC Tracker to manage distributed devices.
The RPC Tracker is a centralized master node. We can register all devices to
the tracker. For example, if we have 10 phones, we can register all of them
to the tracker, and run 10 measurements in parallel, accelerating the tuning process.</p>
<p>To start an RPC tracker, run this command on the host machine. The tracker is
required during the whole tuning process, so we need to open a new terminal for
this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m tvm.exec.rpc_tracker --host<span class="o">=</span><span class="m">0</span>.0.0.0 --port<span class="o">=</span><span class="m">9190</span>
</pre></div>
</div>
<p>The expected output is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>INFO:RPCTracker:bind to <span class="m">0</span>.0.0.0:9190
</pre></div>
</div>
</div>
<div class="section" id="register-devices-to-rpc-tracker">
<h2>Register devices to RPC Tracker<a class="headerlink" href="#register-devices-to-rpc-tracker" title="Permalink to this headline">Â¶</a></h2>
<p>Now we can register our devices to the tracker. The first step is to
build tvm runtime for the ARM devices.</p>
<ul>
<li><p class="first">For Linux:
Follow this section <a class="reference internal" href="../frontend/deploy_model_on_rasp.html#build-tvm-runtime-on-device"><span class="std std-ref">Build TVM Runtime on Device</span></a> to build
tvm runtime on the device. Then register the device to tracker by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m tvm.exec.rpc_server --tracker<span class="o">=[</span>HOST_IP<span class="o">]</span>:9190 --key<span class="o">=</span>rk3399
</pre></div>
</div>
<p>(replace <code class="code docutils literal notranslate"><span class="pre">[HOST_IP]</span></code> with the IP address of your host machine)</p>
</li>
<li><p class="first">For Android:
Follow this <a class="reference external" href="https://github.com/dmlc/tvm/tree/master/apps/android_rpc">readme page</a> to
install tvm rpc apk on the android device. Make sure you can pass the android rpc test.
Then you have already registred your device. During tuning, you have to go to developer option
and enable âKeep screen awake during changingâ and charge your phone to make it stable.</p>
</li>
</ul>
<p>After registering devices, we can confirm it by querying rpc_tracker</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m tvm.exec.query_rpc_tracker --host<span class="o">=</span><span class="m">0</span>.0.0.0 --port<span class="o">=</span><span class="m">9190</span>
</pre></div>
</div>
<p>For example, if we have 2 Huawei mate10 pro, 11 Raspberry Pi 3B and 2 rk3399,
the output can be</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Queue Status
----------------------------------
key          total  free  pending
----------------------------------
mate10pro    <span class="m">2</span>      <span class="m">2</span>     <span class="m">0</span>
rk3399       <span class="m">2</span>      <span class="m">2</span>     <span class="m">0</span>
rpi3b        <span class="m">11</span>     <span class="m">11</span>    <span class="m">0</span>
----------------------------------
</pre></div>
</div>
<p>You can register multiple devices to the tracker to accelerate the measurement in tuning.</p>
</div>
<div class="section" id="set-tuning-options">
<h2>Set Tuning Options<a class="headerlink" href="#set-tuning-options" title="Permalink to this headline">Â¶</a></h2>
<p>Before tuning, we should apply some configurations. Here I use an RK3399 board
as example. In your setting, you should modify the target and device_key accordingly.
set <code class="code docutils literal notranslate"><span class="pre">use_android</span></code> to True if you use android phone.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#### DEVICE CONFIG ####</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">tvm</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;opencl -device=mali&#39;</span><span class="p">)</span>

<span class="c1"># Replace &quot;aarch64-linux-gnu&quot; with the correct target of your board.</span>
<span class="c1"># This target host is used for cross compilation. You can query it by :code:`gcc -v` on your device.</span>
<span class="n">target_host</span> <span class="o">=</span> <span class="s1">&#39;llvm -target=aarch64-linux-gnu&#39;</span>

<span class="c1"># Also replace this with the device key in your tracker</span>
<span class="n">device_key</span> <span class="o">=</span> <span class="s1">&#39;rk3399&#39;</span>

<span class="c1"># Set this to True if you use android phone</span>
<span class="n">use_android</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1">#### TUNING OPTION ####</span>
<span class="n">network</span> <span class="o">=</span> <span class="s1">&#39;resnet-18&#39;</span>
<span class="n">log_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.log&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device_key</span><span class="p">,</span> <span class="n">network</span><span class="p">)</span>
<span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float32&#39;</span>

<span class="n">tuning_option</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;log_filename&#39;</span><span class="p">:</span> <span class="n">log_file</span><span class="p">,</span>

    <span class="s1">&#39;tuner&#39;</span><span class="p">:</span> <span class="s1">&#39;xgb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;n_trial&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s1">&#39;early_stopping&#39;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span>

    <span class="s1">&#39;measure_option&#39;</span><span class="p">:</span> <span class="n">autotvm</span><span class="o">.</span><span class="n">measure_option</span><span class="p">(</span>
        <span class="n">builder</span><span class="o">=</span><span class="n">autotvm</span><span class="o">.</span><span class="n">LocalBuilder</span><span class="p">(</span>
            <span class="n">build_func</span><span class="o">=</span><span class="s1">&#39;ndk&#39;</span> <span class="k">if</span> <span class="n">use_android</span> <span class="k">else</span> <span class="s1">&#39;default&#39;</span><span class="p">),</span>
        <span class="n">runner</span><span class="o">=</span><span class="n">autotvm</span><span class="o">.</span><span class="n">RPCRunner</span><span class="p">(</span>
            <span class="n">device_key</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9190</span><span class="p">,</span>
            <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>How to set tuning options</p>
<p class="last">In general, the default values provided here work well.
If you have enough time budget, you can set <code class="code docutils literal notranslate"><span class="pre">n_trial</span></code>, <code class="code docutils literal notranslate"><span class="pre">early_stopping</span></code> larger,
which makes the tuning run longer.
If your device runs very slow or your conv2d operators have many GFLOPs, considering to
set timeout larger.</p>
</div>
</div>
<div class="section" id="begin-tuning">
<h2>Begin Tuning<a class="headerlink" href="#begin-tuning" title="Permalink to this headline">Â¶</a></h2>
<p>Now we can extract tuning tasks from the network and begin tuning.
Here, we provide a simple utility function to tune a list of tasks.
This function is just an initial implementation which tunes them in sequential order.
We will introduce a more sophisticated tuning scheduler in the future.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># You can skip the implementation of this function for this tutorial.</span>
<span class="k">def</span> <span class="nf">tune_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span>
               <span class="n">measure_option</span><span class="p">,</span>
               <span class="n">tuner</span><span class="o">=</span><span class="s1">&#39;xgb&#39;</span><span class="p">,</span>
               <span class="n">n_trial</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
               <span class="n">early_stopping</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;tuning.log&#39;</span><span class="p">,</span>
               <span class="n">use_transfer_learning</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
               <span class="n">try_winograd</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">try_winograd</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># try winograd template</span>
                <span class="n">tsk</span> <span class="o">=</span> <span class="n">autotvm</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                                          <span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">target_host</span><span class="p">,</span> <span class="s1">&#39;winograd&#39;</span><span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsk</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="c1"># create tmp log file</span>
    <span class="n">tmp_log_file</span> <span class="o">=</span> <span class="n">log_filename</span> <span class="o">+</span> <span class="s2">&quot;.tmp&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tsk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">tasks</span><span class="p">)):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;[Task </span><span class="si">%2d</span><span class="s2">/</span><span class="si">%2d</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span>

        <span class="c1"># create tuner</span>
        <span class="k">if</span> <span class="n">tuner</span> <span class="o">==</span> <span class="s1">&#39;xgb&#39;</span> <span class="ow">or</span> <span class="n">tuner</span> <span class="o">==</span> <span class="s1">&#39;xgb-rank&#39;</span><span class="p">:</span>
            <span class="n">tuner_obj</span> <span class="o">=</span> <span class="n">XGBTuner</span><span class="p">(</span><span class="n">tsk</span><span class="p">,</span> <span class="n">loss_type</span><span class="o">=</span><span class="s1">&#39;rank&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tuner</span> <span class="o">==</span> <span class="s1">&#39;ga&#39;</span><span class="p">:</span>
            <span class="n">tuner_obj</span> <span class="o">=</span> <span class="n">GATuner</span><span class="p">(</span><span class="n">tsk</span><span class="p">,</span> <span class="n">pop_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tuner</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
            <span class="n">tuner_obj</span> <span class="o">=</span> <span class="n">RandomTuner</span><span class="p">(</span><span class="n">tsk</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tuner</span> <span class="o">==</span> <span class="s1">&#39;gridsearch&#39;</span><span class="p">:</span>
            <span class="n">tuner_obj</span> <span class="o">=</span> <span class="n">GridSearchTuner</span><span class="p">(</span><span class="n">tsk</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tuner: &quot;</span> <span class="o">+</span> <span class="n">tuner</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_transfer_learning</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">):</span>
                <span class="n">tuner_obj</span><span class="o">.</span><span class="n">load_history</span><span class="p">(</span><span class="n">autotvm</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">))</span>

        <span class="c1"># do tuning</span>
        <span class="n">tuner_obj</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">n_trial</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">n_trial</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsk</span><span class="o">.</span><span class="n">config_space</span><span class="p">)),</span>
                       <span class="n">early_stopping</span><span class="o">=</span><span class="n">early_stopping</span><span class="p">,</span>
                       <span class="n">measure_option</span><span class="o">=</span><span class="n">measure_option</span><span class="p">,</span>
                       <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
                           <span class="n">autotvm</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">(</span><span class="n">n_trial</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">),</span>
                           <span class="n">autotvm</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">log_to_file</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">)])</span>

    <span class="c1"># pick best records to a cache file</span>
    <span class="n">autotvm</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">pick_best</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">,</span> <span class="n">log_filename</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp_log_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we launch tuning jobs and evaluate the end-to-end performance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tune_and_evaluate</span><span class="p">(</span><span class="n">tuning_opt</span><span class="p">):</span>
    <span class="c1"># extract workloads from relay program</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Extract tasks...&quot;</span><span class="p">)</span>
    <span class="n">net</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_network</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">autotvm</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">extract_from_program</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">target_host</span><span class="o">=</span><span class="n">target_host</span><span class="p">,</span>
                                              <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">ops</span><span class="o">=</span><span class="p">(</span><span class="n">relay</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">conv2d</span><span class="p">,))</span>

    <span class="c1"># run tuning tasks</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Tuning...&quot;</span><span class="p">)</span>
    <span class="n">tune_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="o">**</span><span class="n">tuning_opt</span><span class="p">)</span>

    <span class="c1"># compile kernels with history best records</span>
    <span class="k">with</span> <span class="n">autotvm</span><span class="o">.</span><span class="n">apply_history_best</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Compile...&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">relay</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">opt_level</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">graph</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">relay</span><span class="o">.</span><span class="n">build_module</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
                <span class="n">net</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">target_host</span><span class="o">=</span><span class="n">target_host</span><span class="p">)</span>
        <span class="c1"># export library</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">tempdir</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">use_android</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tvm.contrib</span> <span class="kn">import</span> <span class="n">ndk</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;net.so&quot;</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">export_library</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">ndk</span><span class="o">.</span><span class="n">create_shared</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;net.tar&quot;</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">export_library</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="c1"># upload module to device</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Upload...&quot;</span><span class="p">)</span>
        <span class="n">remote</span> <span class="o">=</span> <span class="n">autotvm</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">request_remote</span><span class="p">(</span><span class="n">device_key</span><span class="p">,</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">9190</span><span class="p">,</span>
                                                <span class="n">timeout</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">rlib</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># upload parameters to device</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">rlib</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="n">data_tvm</span> <span class="o">=</span> <span class="n">tvm</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">input_shape</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">module</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data_tvm</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># evaluate</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Evaluate inference time cost...&quot;</span><span class="p">)</span>
        <span class="n">ftimer</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">time_evaluator</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">prof_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ftimer</span><span class="p">()</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># convert to millisecond</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mean inference time (std dev): </span><span class="si">%.2f</span><span class="s2"> ms (</span><span class="si">%.2f</span><span class="s2"> ms)&quot;</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prof_res</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">prof_res</span><span class="p">)))</span>

<span class="c1"># We do not run the tuning in our webpage server since it takes too long.</span>
<span class="c1"># Uncomment the following line to run it by yourself.</span>

<span class="c1"># tune_and_evaluate(tuning_option)</span>
</pre></div>
</div>
</div>
<div class="section" id="sample-output">
<h2>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">Â¶</a></h2>
<p>The tuning needs to compile many programs and extract feature from them.
So a high performance CPU is recommended.
One sample output is listed below. It takes about 3 hours on a 32T AMD Ryzen Threadripper.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Extract tasks...
Tuning...
<span class="o">[</span>Task  <span class="m">1</span>/17<span class="o">]</span>  Current/Best:   <span class="m">25</span>.30/  <span class="m">39</span>.12 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">992</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">751</span>.22 s Done.
<span class="o">[</span>Task  <span class="m">2</span>/17<span class="o">]</span>  Current/Best:   <span class="m">40</span>.70/  <span class="m">45</span>.50 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">736</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">545</span>.46 s Done.
<span class="o">[</span>Task  <span class="m">3</span>/17<span class="o">]</span>  Current/Best:   <span class="m">38</span>.83/  <span class="m">42</span>.35 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">992</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">1549</span>.85 s Done.
<span class="o">[</span>Task  <span class="m">4</span>/17<span class="o">]</span>  Current/Best:   <span class="m">23</span>.31/  <span class="m">31</span>.02 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">640</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">1059</span>.31 s Done.
<span class="o">[</span>Task  <span class="m">5</span>/17<span class="o">]</span>  Current/Best:    <span class="m">0</span>.06/   <span class="m">2</span>.34 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">544</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">305</span>.45 s Done.
<span class="o">[</span>Task  <span class="m">6</span>/17<span class="o">]</span>  Current/Best:   <span class="m">10</span>.97/  <span class="m">17</span>.20 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">992</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">1050</span>.00 s Done.
<span class="o">[</span>Task  <span class="m">7</span>/17<span class="o">]</span>  Current/Best:    <span class="m">8</span>.98/  <span class="m">10</span>.94 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">928</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">421</span>.36 s Done.
<span class="o">[</span>Task  <span class="m">8</span>/17<span class="o">]</span>  Current/Best:    <span class="m">4</span>.48/  <span class="m">14</span>.86 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">704</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">582</span>.60 s Done.
<span class="o">[</span>Task  <span class="m">9</span>/17<span class="o">]</span>  Current/Best:   <span class="m">10</span>.30/  <span class="m">25</span>.99 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">864</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">899</span>.85 s Done.
<span class="o">[</span>Task <span class="m">10</span>/17<span class="o">]</span>  Current/Best:   <span class="m">11</span>.73/  <span class="m">12</span>.52 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">608</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">304</span>.85 s Done.
<span class="o">[</span>Task <span class="m">11</span>/17<span class="o">]</span>  Current/Best:   <span class="m">15</span>.26/  <span class="m">18</span>.68 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">800</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">747</span>.52 s Done.
<span class="o">[</span>Task <span class="m">12</span>/17<span class="o">]</span>  Current/Best:   <span class="m">17</span>.48/  <span class="m">26</span>.71 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">1000</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">1166</span>.40 s Done.
<span class="o">[</span>Task <span class="m">13</span>/17<span class="o">]</span>  Current/Best:    <span class="m">0</span>.96/  <span class="m">11</span>.43 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">960</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">611</span>.65 s Done.
<span class="o">[</span>Task <span class="m">14</span>/17<span class="o">]</span>  Current/Best:   <span class="m">17</span>.88/  <span class="m">20</span>.22 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">672</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">670</span>.29 s Done.
<span class="o">[</span>Task <span class="m">15</span>/17<span class="o">]</span>  Current/Best:   <span class="m">11</span>.62/  <span class="m">13</span>.98 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">736</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">449</span>.25 s Done.
<span class="o">[</span>Task <span class="m">16</span>/17<span class="o">]</span>  Current/Best:   <span class="m">19</span>.90/  <span class="m">23</span>.83 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">608</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">708</span>.64 s Done.
<span class="o">[</span>Task <span class="m">17</span>/17<span class="o">]</span>  Current/Best:   <span class="m">17</span>.98/  <span class="m">22</span>.75 GFLOPS <span class="p">|</span> Progress: <span class="o">(</span><span class="m">736</span>/1000<span class="o">)</span> <span class="p">|</span> <span class="m">1122</span>.60 s Done.
Compile...
Upload...
Evaluate inference <span class="nb">time</span> cost...
Mean inference <span class="nb">time</span> <span class="o">(</span>std dev<span class="o">)</span>: <span class="m">128</span>.05 ms <span class="o">(</span><span class="m">7</span>.74 ms<span class="o">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Experiencing Difficulties?</strong></p>
<p>The auto tuning module is error-prone. If you always see â 0.00/ 0.00 GFLOPSâ,
then there must be something wrong.</p>
<p>First, make sure you set the correct configuration of your device.
Then, you can print debug information by adding these lines in the beginning
of the script. It will print every measurement result, where you can find useful
error messages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;autotvm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Finally, always feel free to ask our community for help on <a class="reference external" href="https://discuss.tvm.ai">https://discuss.tvm.ai</a></p>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  0.001 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-autotvm-tune-relay-mobile-gpu-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/643e9a98c0816dd3cd04901e277fb9eb/tune_relay_mobile_gpu.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tune_relay_mobile_gpu.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/f85d833da5018098791142b93e00efea/tune_relay_mobile_gpu.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tune_relay_mobile_gpu.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tune_relay_arm.html" class="btn btn-neutral float-right" title="Auto-tuning a convolutional network for ARM CPU" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tune_relay_cuda.html" class="btn btn-neutral float-left" title="Auto-tuning a convolutional network for NVIDIA GPU" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, tvm developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75982049-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>